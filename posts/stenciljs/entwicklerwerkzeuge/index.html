<!doctype html>
<html lang="de">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <title>StencilJS-Tutorial: Entwicklungswerkzeuge einrichten</title>
        <meta name="description" content="Skripte einrichten">
        <meta property="og:title" content="Speakaoke – Spontane Präsentationen mit KI"/>
        <meta property="og:image" content="/android-chrome-384x384.png"/>
        <meta property="og:url" content="https://derkuba.de/posts/0225/speakaoke/"/>
        <meta property="og:type" content="website"/>
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="der_kuba">
        <link rel="alternate" href="/feed/feed.json" type="application/json" title="der_kuba">
        <link rel="stylesheet" href="/assets/css/prism.css">
        <link rel="stylesheet" href="/assets/css/bulma.css">
        <link rel="stylesheet" href="/assets/css/custom.css">
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const e = Array
                    .prototype
                    .slice
                    .call(document.querySelectorAll(".navbar-burger"), 0);
                e.length > 0 && e.forEach(e => {
                    e.addEventListener("click", () => {
                        const t = e.dataset.target,
                            a = document.getElementById(t);
                        e.classList.toggle("is-active"),
                        a.classList.toggle("is-active")
                    })
                })
                const disableDarkMode = () => {
                    const bodyNode = document.querySelector("body");
                    bodyNode
                        .classList
                        .remove("dark-mode")
                        localStorage
                        .setItem('darkMode', 'disabled');
                }
                const enableDarkMode = () => {
                    const bodyNode = document.querySelector("body");
                    bodyNode
                        .classList
                        .add("dark-mode")
                        localStorage
                        .setItem('darkMode', 'enabled');
                }
                const button = document.getElementById("darkmode");
                button.addEventListener("click", () => {
                    const bodyNode = document.querySelector("body");
                    if (bodyNode.classList.contains("dark-mode")) {
                        disableDarkMode();
                    } else {
                        enableDarkMode();
                    }
                })
                if (localStorage.getItem('darkMode') === 'enabled') {
                    enableDarkMode();
                }
            });
        </script>
    </head>
    <body><header>
    <div class="container">
        <nav class="navbar">
            <div class="navbar-brand">
                <a class="navbar-item navbar-brand__title " href="/">
                    der_kuba
                </a>
                <a class="navbar-item is-size-7-mobile" href="https://github.com/derKuba">
                    @Github
                </a>
                <a class="navbar-item is-size-7-mobile" href="https://twitter.com/der_kuba">
                    @Twitter
                </a>
                <a class="navbar-item is-size-7-mobile" href="https://www.linkedin.com/in/jacob-pawlik-08a40015b/">
                    @LinkedIn
                </a>
                <div class="navbar-burger" data-target="navigation-items">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <div id="navigation-items" class="navbar-menu">
                <div class="navbar-end">
                    
                        <a class="navbar-item " href="/">
                            Home
                        </a>
                        <a class="navbar-item " href="/posts/">
                            Archiv
                        </a>
                        <a class="navbar-item " href="/about/">
                            About Me
                        </a>
                        <a class="navbar-item " href="/en/">
                            English
                        </a>
                        <a class="navbar-item " href="/content/impressum.html">
                            Impressum
                        </a>
                        <a class="navbar-item " href="/content/datenschutz.html">
                            Datenschutzerklärung
                        </a>
                    <button id="darkmode" alt="dark mode">
                        <svg width="30" height="30">
                            <circle cx="15" cy="15" r="6" fill="currentColor"/>
                            <line id="ray" stroke="currentColor" stroke-width="2" stroke-linecap="round" x1="15" y1="1" x2="15" y2="4"></line>
                            <use href="#ray" transform="rotate(45 15 15)"/>
                            <use href="#ray" transform="rotate(90 15 15)"/>
                            <use href="#ray" transform="rotate(135 15 15)"/>
                            <use href="#ray" transform="rotate(180 15 15)"/>
                            <use href="#ray" transform="rotate(225 15 15)"/>
                            <use href="#ray" transform="rotate(270 15 15)"/>
                            <use href="#ray" transform="rotate(315 15 15)"/>
                        </svg>
                    </button>
                    <!-- special thanks to https://www.freecodecamp.org/news/how-to-handle-dark-mode-with-css-and-javascript/ -->
                </div>
            </div>
        </nav>
    </div>
</header>
        
<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <h1 class="title is-3">StencilJS-Tutorial: Entwicklungswerkzeuge einrichten</h1>
        <div class="post-detail__tags">
          <h3 class="subtitle is-6">
            <time datetime="2021-06-04">
              04 Jun 2021
            </time>
          </h3>
          <div class="tags"><a href="/tags/stenciljs/" class="post-tag">
                <span class="tag is-black">
                  Stenciljs
                </span>
              </a>
          </div>
        </div>
        <div class="content post_detail__content">
          <div class="language-hint">
            
          </div>
          <p>Nachdem wir das StencilJS-Starter-Projekt aufgesetzt haben, fügen wir jetzt noch die nötigen Entwicklerwerkzeuge und ein CSS-Framework zum Projekt hinzu. Ziel dieser Werkzeuge ist ein einheitlicher und qualitativ-hochwertiger Code. <!-- endOfPreview --></p>
<p>Die Entwicklungswerkzeuge sind folgende:</p>
<ol>
<li><a href="https://prettier.io/docs/en/install.html">Prettier</a></li>
<li><a href="https://eslint.org/docs/user-guide/getting-started">Eslint</a></li>
<li><a href="https://jestjs.io/">JEST</a></li>
<li>An dieser Stelle steht in meinen Real-Life-Projekten immer <a href="https://storybook.js.org/">Storybook</a></li>
</ol>
<p>Zum installieren folge ich den Anleitungen auf der jeweiligen Seite.</p>
<h3>Prettier</h3>
<p>Prettier ist ein Formatierungswerkzeug und sorgt dafür, dass alle Code-Dateien im gleichen Stil geschrieben werden. Auf die Regeln sollte man sich im Team vorher einigen und dann befolgen.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token comment"># Module zu den dev-dependencies hinzufügen</span></span>
<span class="highlight-line"><span class="token function">npm</span> <span class="token function">install</span> --save-dev --save-exact prettier</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token comment"># Konfigurationsdatei hinzufügen</span></span>
<span class="highlight-line"><span class="token builtin class-name">echo</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> .prettierrc.json</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token comment"># Ausnahme-Datei hinzufügen ( es sollen ja nicht alle Dateien analysiert und formattiert werden)</span></span>
<span class="highlight-line"><span class="token builtin class-name">echo</span> node_modules<span class="token operator">></span> .prettierignore</span></code></pre>
<p>Damit ist Prettier installiert. Jetzt muss man es noch konfigurieren, d.h. Regeln und Ausnahmen hinzufügen. In die ignore schreibe ich standardmäßig für ein StencilJS-Projekt folgende Ausnahmen:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">node_modules</span>
<span class="highlight-line">dist</span>
<span class="highlight-line">www</span>
<span class="highlight-line">build</span>
<span class="highlight-line">public</span>
<span class="highlight-line">node_modules</span>
<span class="highlight-line">coverage</span>
<span class="highlight-line">*.svg</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token comment"># This file is changed by the stencil compiler</span></span>
<span class="highlight-line">src/components.d.ts</span></code></pre>
<p>Bei <a href="https://prettier.io/docs/en/options.html">den Konfigurationsregeln</a> gibt es kein richtig oder falsch. Diese sollten individuell diskutiert werden und zum Projektstart aber feststehen. Ich habe mich jetzt für folgende Regeln entschieden:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token string">"printWidth"</span><span class="token builtin class-name">:</span> <span class="token number">80</span>,</span>
<span class="highlight-line">    <span class="token string">"useTabs"</span><span class="token builtin class-name">:</span> false,</span>
<span class="highlight-line">    <span class="token string">"semi"</span><span class="token builtin class-name">:</span> true,</span>
<span class="highlight-line">    <span class="token string">"tabWidth"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,</span>
<span class="highlight-line">    <span class="token string">"singleQuote"</span><span class="token builtin class-name">:</span> false,</span>
<span class="highlight-line">    <span class="token string">"trailingComma"</span><span class="token builtin class-name">:</span> <span class="token string">"all"</span>,</span>
<span class="highlight-line">    <span class="token string">"bracketSpacing"</span><span class="token builtin class-name">:</span> true,</span>
<span class="highlight-line">    <span class="token string">"arrowParens"</span><span class="token builtin class-name">:</span> <span class="token string">"always"</span>,</span>
<span class="highlight-line">    <span class="token string">"jsxSingleQuote"</span><span class="token builtin class-name">:</span> false,</span>
<span class="highlight-line">    <span class="token string">"jsxBracketSameLine"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Die Zeilenlänge habe ich auf 80 Zeichen gesetzt, verwende Leerzeichen statt Tabs, verlange ein Semikolon nach jedem Statement, Tabweite liegt bei 2 Zeichen, verwende &quot; statt ' , etc.</p>
<p>Die Prettier-Konfiguration kann in jeder IDE übernommen werden und dann automatisch beim Speichern ausgeführt werden. Ich mag zusätzlich noch die Option es per NPM auszuführen.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">// package.json</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token punctuation">..</span><span class="token punctuation">..</span></span>
<span class="highlight-line">scripts: <span class="token punctuation">{</span></span>
<span class="highlight-line"><span class="token punctuation">..</span>.</span>
<span class="highlight-line"> <span class="token string">"prettier"</span><span class="token builtin class-name">:</span> <span class="token string">"prettier --write src"</span>,</span>
<span class="highlight-line"><span class="token punctuation">..</span>.</span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Wenn ich nun <strong>npm run prettier</strong> in der Konsole ausführe, wird der gesamte Code (ohne die Ausnahmen) analysiert und durch das <em>--write</em>-Flag auch korrigiert. ACHTUNG: Es werden mitunter sehr viele Dateien angefasst. Das verfälscht den Merge-Request.</p>
<h3>ESLINT</h3>
<p>ESLINT ist ein Werkzeug zur statischen Code-Analyse. Es untersucht neben dem Programmierstil noch die Qualität und gibt sogar Tipps für eine bessere Implementierung. Ein MUSS in jedem Projekt. Es ist komplett Konfigurierbar. Jede Regel lässt sich ein- und ausschalten oder eine Warnung werfen. Zusätzlich kann man sich Regelsätze von anderen Projekten installieren. Ich nehme immer Regelpakete der großen Softwarehäuser wie Google, Microsoft, etc.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">// installieren</span>
<span class="highlight-line"><span class="token function">npm</span> <span class="token function">install</span> eslint --save-dev</span>
<span class="highlight-line"></span>
<span class="highlight-line">// initiieren</span>
<span class="highlight-line">npx eslint <span class="token parameter variable">--init</span></span></code></pre>
<p><img src="/content/img/stenciljs-tutorial/eslint-init.png" alt="eslint init" title="eslint init"><div class="has-text-right image-subline">Bild 1: Eslint Init CLI</div></p>
<p>Nachdem man diesen Installations-Wizard ausgeführt hat, erscheint eine Konfigurationsdatei <strong>eslintrc.js</strong> im Root des Projekts.</p>
<pre class="language-json"><code class="language-json"><span class="highlight-line">module.exports = <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// Wo läuft der Code ? => im browser in ES6+</span></span>
<span class="highlight-line">        <span class="token property">"browser"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="highlight-line">        <span class="token property">"es2021"</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="highlight-line">    <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// welches Regelwerk wird verwendet?</span></span>
<span class="highlight-line">        <span class="token string">"standard"</span><span class="token punctuation">,</span></span>
<span class="highlight-line">        <span class="token string">"eslint:recommended"</span></span>
<span class="highlight-line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="highlight-line">    <span class="token property">"parser"</span><span class="token operator">:</span> <span class="token string">"@typescript-eslint/parser"</span><span class="token punctuation">,</span> <span class="token comment">// Wir verwenden Typescript!</span></span>
<span class="highlight-line">    <span class="token property">"parserOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// Konfigurationen</span></span>
<span class="highlight-line">        <span class="token property">"ecmaVersion"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span></span>
<span class="highlight-line">        <span class="token property">"sourceType"</span><span class="token operator">:</span> <span class="token string">"module"</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="highlight-line">    <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// Plugins</span></span>
<span class="highlight-line">        <span class="token string">"@typescript-eslint"</span></span>
<span class="highlight-line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="highlight-line">    <span class="token property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// Individuelle Erweiterung der Regeln</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"><span class="token punctuation">}</span>;</span></code></pre>
<p>Jetzt fügen wir noch ein Script in die package.json hinzu:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">// package.json</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token punctuation">..</span>.</span>
<span class="highlight-line">scripts: <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token punctuation">..</span>.</span>
<span class="highlight-line">    <span class="token string">"eslint"</span><span class="token builtin class-name">:</span> <span class="token string">"eslint --ext .tsx --ext .ts src/"</span>,</span>
<span class="highlight-line">    <span class="token punctuation">..</span>.</span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Nun kann man ESLINT auf der Konsole laufen lassen: <strong>npm run eslint</strong>. In dieser Konfiguration werden Fehler nur gemeldet. Aber ESLINT kann noch mehr. Es kann auch &quot;einfache&quot; Fehler selber beheben. Dafür fügt man dem oberen Script noch den Parameter &quot;--fix&quot; hinzu. Wie durch Magie sind nun aus 173 Fehlern, nur noch 30 Fehler übrig.</p>
<p>In diesem Zustand kommt es noch zu vielen Warnungen und Fehlern. So sind zb. (sollte man vorher prettier ausgeführt haben) die Anführungszeichen einfach, aber wir haben uns im Projekt auf doppelte geeinigt. Im Moment schreibt Prettier doppelte Semikola und ESLINT überschreibt sie mit einfachen. Jetzt muss man beide Werkzeuge verbinden.
Die Lösung lautet <a href="https://github.com/prettier/eslint-plugin-prettier">&quot;eslint-plugin-prettier&quot;</a>.</p>
<p>Dazu müssen wir folgendes ausführen, bzw. in die .eslintrc.js-Config schreiben:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">npm</span> <span class="token function">install</span> --save-dev eslint-config-prettier</span>
<span class="highlight-line"><span class="token function">npm</span> <span class="token function">install</span> --save-dev eslint-plugin-prettier</span>
<span class="highlight-line"></span>
<span class="highlight-line">// .eslintrc.js</span>
<span class="highlight-line"><span class="token punctuation">..</span>.</span>
<span class="highlight-line">    <span class="token string">"extends"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="highlight-line">        <span class="token string">"standard"</span>,</span>
<span class="highlight-line">        <span class="token string">"eslint:recommended"</span>,</span>
<span class="highlight-line">        <span class="token string">"plugin:prettier/recommended"</span></span>
<span class="highlight-line">    <span class="token punctuation">]</span>,</span>
<span class="highlight-line"><span class="token punctuation">..</span>.</span>
<span class="highlight-line"></span></code></pre>
<p>Wenn man nun <strong>npm run eslint</strong> ausführt, folgt der Linter den in Prettier definierten Regeln. Die Semikola bleiben doppelt.</p>
<p>Im aktuellen Setup treten aber noch Fehler, die in Verbindung mit dem Testframework JEST und JSX stehen, auf. Der Linter sagt, dass er weder <em>it</em>, noch <em>describe</em> kennt und auch ein 'h' nicht definiert ist. Ersteres löst man, in dem an in der <em>.eslintrc.js</em> in das <em>&quot;env&quot;</em> Property ein <strong>&quot;jest&quot;: true</strong> ergänzt.</p>
<p>Da dieses Projekt auf StencilJS setzt habe ich noch die <a href="https://github.com/ionic-team/stencil-eslint">empfohlenen StencilJS-Regeln</a> hinzugefügt.</p>
<pre><code>npm i eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin eslint-plugin-react @stencil/eslint-plugin --save-dev

// Ergänzung in der .eslintrc.js
{
  &quot;parserOptions&quot;: {
    &quot;project&quot;: &quot;./tsconfig.json&quot;
  },
  &quot;extends&quot;: [
    &quot;plugin:@stencil/recommended&quot;
  ]
}
</code></pre>
<h3>JEST</h3>
<p>Für die Unit-Tests, aber auch für die E2E Tests empfehle ich JEST. Ich benutze es seit 2016. Es hat alles was man sich wünscht. Man arbeitet sich sehr schnell ein. Die Verwendung von Mocks, Spys, Stubs war nie einfacher. Die Syntax ist angelehnt an JasmineJS.</p>
<p>Um es in diesem Projekt zu Starten muss man lediglich &quot;npm run test&quot; ausführen. Es würde alle Tests, die am Dateinamen ein <em>.spec.</em> oder <em>.e2e.</em> haben ausgeführt. Da ich kein großer Fan der StencilJS E2E Tests bin, aber ich das Flag &quot;--e2e&quot; aus dem Skript in der package.json entfernt.</p>
<p>Beim initialen Start verlangt NPM noch das nachinstallieren gewisser Module. In meinem Fall:</p>
<pre><code>[ ERROR ]  Please install missing dev dependencies with either npm or yarn.
npm install --save-dev @types/jest@26.0.21 jest@26.6.3 jest-cli@26.6.3 @types/puppeteer@5.4.3
puppeteer@5.5.0
</code></pre>
<p>Die Lösung für das Problem steht direkt dabei. Nachdem man die Module installiert hat, und nochmal <em>npm run test</em> ausgeführt hat, sollte folgende Erfolgsmeldung erscheinen:</p>
<pre><code>Test Suites: 4 passed, 4 total
Tests:       11 passed, 11 total
Snapshots:   0 total
Time:        2.099 s
</code></pre>
<p>Das wären alle meine empfohlenen Werkzeuge zum Start des Projektes. Natürlich lassen diese sich nachträglich in bestehende Projekte einbauen. Der initiale Aufwand sollte beim Starten eines neuen Projektes auf keinen Fall umgangen werden. Ich habe diese Tools bei Kunden in bestehende Projekte eingebaut und durfte dann erstmal 12000 Fehler beheben, was ein immenser Aufwand ist. Von nicht vorhandenen Tests möchte ich erst gar nicht anfangen. Viele Projekte mussten wegen fehlender Tests neugestartet werden.</p>
<p>Im nächsten Artikel geht es aber dann endlich mit der eigentlichen Entwicklung los.</p>
<p>Der Code hierzu liegt auf <a href="https://github.com/derKuba/stenciljs-tutorial">Github</a>. Um es auf diesen Stand zu bringen, müsst ihr das Projekt klonen und einmal auf den Tag 0.9.1 auschecken:</p>
<p>Ihr habt Fragen oder Anregungen? Schreibt mir bei <a href="https://twitter.com/der_kuba">Twitter</a>.
<br>
<br>
Tausend Dank fürs Lesen!</p>
<p>Kuba</p>

            <hr>
              <ul class="post-navigation">
                  <li>Nächster Artikel:
                    <a href="/posts/stenciljs/erste-stencil-komponente/">StencilJS-Tutorial: Die erste Komponente</a>
                  </li>
                
                  <li>Vorheriger Artikel:
                    <a href="/posts/stenciljs/projekt-aufsetzen/">StencilJS-Tutorial: 1. Projekt aufsetzen</a>
                  </li>
                
              </ul>
          </div>
        </div>
      </div>
    </div>
  </section>
        <!-- Current page: /posts/stenciljs/entwicklerwerkzeuge/ -->
        <footer class="footer">
    <hr/>
    <div class="content has-text-centered">
        <p>
            der_kuba - 2021-2024 -
            <a href="/content/impressum.html">Impressum</a>
            -
            <a href="/content/datenschutz.html">Datenschutzerklärung</a>
        </p>
    </div>
</footer>
    </body>
</html>