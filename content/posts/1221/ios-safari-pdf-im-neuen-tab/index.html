<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>IOS &amp; Safari: Öffne PDF im neuen Tab</title><meta name="description" content="Hickup der Woche"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link href="/template/css/prism.css" rel="stylesheet"><link rel="stylesheet" href="/template/css/bulma.min.css"><link rel="stylesheet" href="/template/css/custom.css"><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="der_kuba"><link rel="alternate" href="/feed/feed.json" type="application/json" title="der_kuba"><script>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,a=document.getElementById(t);e.classList.toggle("is-active"),a.classList.toggle("is-active")})})});</script></head><body><header><div class="container"><nav class="navbar is-transparent"><div class="navbar-brand"><a class="navbar-item navbar-brand__title" href="/">der_kuba </a><a class="navbar-item" href="https://github.com/derKuba">@Github </a><a class="navbar-item" href="https://twitter.com/der_kuba">@Twitter </a><a class="navbar-item" href="https://www.linkedin.com/in/jacob-pawlik-08a40015b/">@LinkedIn</a><div class="navbar-burger" data-target="navigation-items"><span></span> <span></span> <span></span></div></div><div id="navigation-items" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home </a><a class="navbar-item" href="/posts/">Archiv </a><a class="navbar-item" href="/content/about/">About Me </a><a class="navbar-item" href="/content/impressum.html">Impressum </a><a class="navbar-item" href="/content/datenschutz.html">Datenschutzerklärung</a></div></div></nav></div></header><section class="section"><div class="container"><div class="columns is-centered"><div class="column is-8"><h1 class="title is-3">IOS &amp; Safari: Öffne PDF im neuen Tab</h1><div class="post-detail__tags"><h3 class="subtitle is-6"><time datetime="2021-12-10">10 Dec 2021</time></h3><div class="tags"><a href="/tags/web/" class="post-tag"><span class="tag is-black">Web </span></a><a href="/tags/safari/" class="post-tag"><span class="tag is-primary">Safari</span></a></div></div><div class="content post_detail__content"><p>Ein Thema, das mich in den letzten Wochen beschäftigt hat, war das Öffnen einer PDF im mobilen Safar-Browsers. Der UseCase sieht aus wie folgt:</p><ul><li>In einer Single-Page-Application wird</li><li>ein base64-codierter String wird aus einem Service geliefert</li><li>und soll in einem neuen Tab geöffnet werden, damit der State der Anwendung erhalten bleibt.</li></ul><p>Klang beim ersten Lesen der Anforderung wie ein 0815-Ticket, das dementsprechend klein bewertet wurde. Eine PDF im neuen Tab zu öffnen ist ja auch sehr einfach. Man erzeugt ein virtuelles Anchor-DOM-Element, übergibt den Base64-String im <em>href</em>-Attribut und klickt dann programmatisch drauf.</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token keyword">const</span> anchor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">anchor<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"data:application/application/pdf;base64,"</span> <span class="token operator">+</span> data64<span class="token punctuation">;</span></span><br><span class="highlight-line">anchor<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">"documentName.pdf"</span><span class="token punctuation">;</span></span><br><span class="highlight-line">anchor<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token string">"blank"</span><span class="token punctuation">;</span></span><br><span class="highlight-line">anchor<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Das funktioniert in allen Browsern auch im Safari. In allen &quot;normalen :-)&quot; Browsern öffnet sich in einem neuen Tab die PDF. Auch im Safari öffnet sich ein schicker PDF-Viewer. Also Ticket fertig! Zu. Nächstes Ticket!</p><p>HALT STOP! :-)</p><p>Im Safari öffnet sich der Spaß im selben Tab. Wenn man nun ein Browser-Back aktiviert, ist der State weg. In meinem Fall eine Katastrophe, weil dann sehr viele Daten erneut eingegeben werden müssten. Das Internet ist vollgestopft Fragen zu genau diesem Fall. Applehasser erklären, dass es keine Lösung gibt. Die Apple-Foren überschlagen sich mit Vorschlägen, die alle nicht für mich funktionierten.</p><p>Nach wirklich endlosen Versuchen, haben wir dann eine Lösung gefunden die für uns funktioniert:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line">  <span class="token keyword">private</span> <span class="token function-variable function">downloadPDF</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>base64String<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>base64String<span class="token operator">?.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// https://pretagteam.com/question/display-pdf-in-base64-in-a-new-tab-in-ipad-safari-or-chrome-for-ios-2021</span></span><br><span class="highlight-line">    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">b64toBlob</span><span class="token punctuation">(</span>base64String<span class="token punctuation">,</span> <span class="token string">"application/pdf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre><p>Der base64String wird zu einem Blob gewandelt. Die Funktion habe ich mir aus dem Blog-Artikel geliehen. Sie tut was sie soll. Anschließend wird der Blob in eine ObjectURL gewandelt und über das <em>window</em>-Objekt gewandelt. Die PDF öffnet sich im neuen Tab im nativen PDF-Viewer. Es gibt auch Lösungen die ein PDF in einem IFrame öffnen. Aber auch dort bitte aufpassen. Es wird immer nur die erste Seite des PDFs angezeigt.</p><p>Was sich hier so einfach liest war ein sehr langer Prozess, um die Funktionalität umzusetzen. Aber Ende gut, alles gut. Vielleicht hat ja noch jemand dieses Problem und kann mit dieser Lösung was anfangen :-)</p><p>Ihr habt Fragen oder Anregungen? Schreibt mir bei <a href="https://twitter.com/der_kuba">Twitter</a> oder per <a href="mailto:jacob@derkuba.de">E-Mail</a> .</p><p><br>Tausend Dank fürs Lesen!</p><p>Kuba</p><hr><ul class="post-navigation"><li>Nächster Artikel: <a href="/content/posts/1221/backend-api-mit-koa/">StencilJS-Exkurs: Backend-Api mit Koa</a></li><li>Vorheriger Artikel: <a href="/content/posts/1121/nodejs-application-zertifikat-tipps/">Nodejs Zertifizierung(JSNAD) Tipps</a></li></ul></div></div></div></div></section><footer class="footer"><hr><div class="content has-text-centered"><p>der_kuba - 2023 - <a href="/content/impressum.html">Impressum</a> - <a href="/content/datenschutz.html">Datenschutzerklärung</a></p></div></footer></body></html>