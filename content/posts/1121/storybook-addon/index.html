<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Storybook Addon erstellen und veröffentlichen</title><meta name="description" content="Wie erweitert man Storybook um ein Addon"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link href="/template/css/prism.css" rel="stylesheet"><link rel="stylesheet" href="/template/css/bulma.min.css"><link rel="stylesheet" href="/template/css/custom.css"><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="der_kuba"><link rel="alternate" href="/feed/feed.json" type="application/json" title="der_kuba"><script>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,a=document.getElementById(t);e.classList.toggle("is-active"),a.classList.toggle("is-active")})})});</script></head><body><header><div class="container"><nav class="navbar is-transparent"><div class="navbar-brand"><a class="navbar-item navbar-brand__title" href="/">der_kuba </a><a class="navbar-item" href="https://github.com/derKuba">@Github </a><a class="navbar-item" href="https://twitter.com/der_kuba">@Twitter</a><div class="navbar-burger" data-target="navigation-items"><span></span> <span></span> <span></span></div></div><div id="navigation-items" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home </a><a class="navbar-item" href="/posts/">Archive </a><a class="navbar-item" href="/content/about/">About Me </a><a class="navbar-item" href="/content/impressum.html">Impressum </a><a class="navbar-item" href="/content/datenschutz.html">Datenschutzerklärung</a></div></div></nav></div></header><section class="section"><div class="container"><div class="columns is-centered"><div class="column is-8"><h1 class="title is-3">Storybook Addon erstellen und veröffentlichen</h1><div class="post-detail__tags"><h3 class="subtitle is-6"><time datetime="2021-11-09">09 Nov 2021</time></h3><div class="tags"><a href="/tags/stencil/" class="post-tag"><span class="tag is-black">Stencil </span></a><a href="/tags/storybook/" class="post-tag"><span class="tag is-primary">Storybook</span></a></div></div><div class="content post_detail__content"><p>Heute zeige ich wie man ein Storybook Addon schreibt. Jedes Projekt ist individuell und einzigartig sind auch die Anforderungen. Storybook bietet einen breiten Katalog an <a href="https://storybook.js.org/addons">Addons</a> an. Ein tolles Feature, das das Entwicklungsteam anbietet, ist die Möglichkeit weitere Addons selber zu schreiben. Dabei kann man dann selber entscheiden, ob man es in den Katalog aufnehmen lassen möchte, oder ob man es einfach nur in sein Projekt integriert. Aber wie erstellt man nun ein Addon?<br>Dazu gibt es <a href="https://storybook.js.org/docs/react/addons/writing-addons/">eine Anleitung und auch eine API</a>. Es zum Starten zwei Möglichkeiten. Man kann auf einer grünen Wiese starten oder man klont das <a href="https://github.com/storybookjs/addon-kit">Starterprojekt</a> und ergänzt dieses. Wir machen heute ersteres.</p><h4 id="initiales-setup" tabindex="-1">Initiales Setup <a class="direct-link" href="#initiales-setup">#</a></h4><p>Analog zu den vorherigen Artikeln legen wir einen Ordner an, initalisieren ein NPM-Projekt und beginnen dann die Storybook Addons dependencies hinzuzufügen.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">mkdir</span> storybook-addon-hello-world</span><br><span class="highlight-line"><span class="token builtin class-name">cd</span> storybook-addon-hello-world</span><br><span class="highlight-line"><span class="token function">npm</span> init</span></code></pre><p>Damit steht das Gerüst. Unser Addon wird in React geschrieben und mit Hilfe von Babel transpiliert. Als nächstes fügen wir Babel zum Projekt hinzu.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">npm</span> <span class="token function">install</span> -D @babel/cli @babel/preset-env @babel/preset-react</span></code></pre><p>Anschließend legen wir eine Babel-Konfigurationsdatei (.babelrc.js_) an und füllen diese mit Leben.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">touch</span> .babelrc.js</span></code></pre><pre class="language-js"><code class="language-js"><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span> <span class="token string">"@babel/preset-react"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre><p>In Zeile 2 sehen wir nun, dass die zuvor installierten Presets zum Zug kommen. Ein Preset ist eine kleine Sammlung von Plugins, um eine Sprache zu unterstützen. In unserem Fall <a href="https://www.w3schools.com/js/js_es6.asp">ES6+</a>.</p><p>Jetzt tragen wir den Babel-Befehl, das Babel-Skript, in unsere package.json ein.</p><pre class="language-json"><code class="language-json"><span class="highlight-line">...</span><br><span class="highlight-line">scripts<span class="token operator">:</span><span class="token punctuation">{</span></span><br><span class="highlight-line"><span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"babel ./src --out-dir ./dist --ignore '**/*.spec.jsx'"</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">....</span></code></pre><p>In Zeile 3 sehen wir den Befehl. Der erste Parameter ist das Quellverzeichnis <em>/src</em>. Es folgt das Zielverzeichnis, <em>/dist</em>. Daneben gesellt sich eine Ignorierliste: die Tests. Diese müssen nicht transpiliert werden. Um es zu testen benötigen wir noch etwas Code und das Quellverzeichnis.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">mkdir</span> src</span><br><span class="highlight-line"><span class="token builtin class-name">cd</span> src</span><br><span class="highlight-line"><span class="token function">touch</span> presets.js</span><br><span class="highlight-line"><span class="token function">touch</span> register.js</span></code></pre><p>Jetzt existiert das Quellverzeichnis und wir haben die Einstiegsdatei <em>presets.js</em>. Diese Datei sucht Storybook für den Einstieg. In dieser registrieren wir unser Plugin. In der <em>register.js</em>-Datei beginnt React.</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token comment">// presets.js</span></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">managerEntries</span><span class="token punctuation">(</span>entry <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>entry<span class="token punctuation">,</span> <span class="token keyword">require</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./register"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> managerEntries <span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre><p>Jetzt können wir mal den build-Befehl ausführen.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">npm</span> run build</span></code></pre><p>Es entsteht ein Ordner <em>/dist</em> in dem sich die Datei <em>presets.js</em> und hat nun etwas mehr Inhalt.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token string">"use strict"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">_toConsumableArray</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">        <span class="token function">_arrayWithoutHoles</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">||</span></span><br><span class="highlight-line">        <span class="token function">_iterableToArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">||</span></span><br><span class="highlight-line">        <span class="token function">_unsupportedIterableToArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">||</span></span><br><span class="highlight-line">        <span class="token function">_nonIterableSpread</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">_nonIterableSpread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span></span><br><span class="highlight-line">        <span class="token string">"Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."</span></span><br><span class="highlight-line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">_unsupportedIterableToArray</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> minLen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>o<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> o <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">_arrayLikeToArray</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> minLen<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token string">"Object"</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> n <span class="token operator">=</span> o<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name<span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token string">"Map"</span> <span class="token operator">||</span> n <span class="token operator">===</span> <span class="token string">"Set"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token string">"Arguments"</span> <span class="token operator">||</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> <span class="token function">_arrayLikeToArray</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> minLen<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">_iterableToArray</span><span class="token punctuation">(</span><span class="token parameter">iter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">        <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span> iter<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span></span><br><span class="highlight-line">        iter<span class="token punctuation">[</span><span class="token string">"@@iterator"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span></span><br><span class="highlight-line">    <span class="token punctuation">)</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>iter<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">_arrayWithoutHoles</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">_arrayLikeToArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">_arrayLikeToArray</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> len</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> len <span class="token operator">></span> arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> arr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> arr2<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">managerEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">var</span> entry <span class="token operator">=</span></span><br><span class="highlight-line">        arguments<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">_toConsumableArray</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">        require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./register"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    managerEntries<span class="token operator">:</span> managerEntries<span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre><p>Der Inhalt ist transpiliertes und im Browser lauffähiges Javascript. Damit funktioniert unser Setup. Ich schlage noch eine kleine Erweiterung vor: einen Watcher.<br>Im aktuellen Setup muss man nach jeder Änderung den Befehl ausführen, um zu transpilieren. Es gibt ein npm-Modul, das eine Änderung am Sourcecode erkennt und den Build-Befehl ausführt.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">npm</span> <span class="token function">install</span> -D npm-watch</span></code></pre><p>In die <em>package.json</em> fügen wir noch die Watch-Konfiguration.</p><pre class="language-json"><code class="language-json"><span class="highlight-line"><span class="token comment">// package.json</span></span><br><span class="highlight-line"> <span class="token property">"watch"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token property">"patterns"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">        <span class="token string">"src"</span></span><br><span class="highlight-line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"extensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">        <span class="token string">"js,jsx"</span></span><br><span class="highlight-line">      <span class="token punctuation">]</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span></code></pre><p>Unter watch kommt der Befehl, der nach einer Änderung ausgeführt werden soll. Es ist der bekannte, und oben genannte Build-Befehl. Um das Watching zu starten, benötigen wir einen weiteren Skritpbefehl.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token string">"dev"</span><span class="token builtin class-name">:</span> <span class="token string">"npm-watch build"</span>,</span></code></pre><p>Ich hab mir angewöhnt meine Arbeitstasks immer &quot;dev&quot; zu nennen.<br>Mit <em>npm run dev</em>. Starte ich damit den Watcher, der beobachtet die Dateien unter <em>patterns</em> mit der Dateiendung (<em>extensions</em>) <em>.js, .jsx</em>.</p><p>Das erhöht ungemein die Arbeitsgeschwindigkeit und den Komfort.</p><h4 id="plugin-development" tabindex="-1">Plugin Development <a class="direct-link" href="#plugin-development">#</a></h4><p>Jetzt geht es an die Fachlichkeit. Wie bereits erwähnt ist die <em>register.js</em> die Einstiegsdatei für das UI.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token comment">// register.js</span></span><br><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> addons<span class="token punctuation">,</span> types <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@storybook/addons"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AddonPanel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@storybook/components"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token constant">ADDON_ID</span> <span class="token operator">=</span> <span class="token string">"myaddon"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token constant">PANEL_ID</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">ADDON_ID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/panel</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">addons<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token constant">ADDON_ID</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">api</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    addons<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">PANEL_ID</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        type<span class="token operator">:</span> types<span class="token punctuation">.</span><span class="token constant">PANEL</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        title<span class="token operator">:</span> <span class="token string">"My Hello World"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> active<span class="token punctuation">,</span> key <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span></span><br><span class="highlight-line">            <span class="token operator">&lt;</span>AddonPanel active<span class="token operator">=</span><span class="token punctuation">{</span>active<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>key<span class="token punctuation">}</span><span class="token operator">></span></span><br><span class="highlight-line">                <span class="token operator">&lt;</span>div<span class="token operator">></span> hello world <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></span><br><span class="highlight-line">            <span class="token operator">&lt;</span><span class="token operator">/</span>AddonPanel<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token operator">-</span>   npm link</span><br><span class="highlight-line"><span class="token comment">// npm link</span></span><br><span class="highlight-line"><span class="token comment">// npm link npm link storybook-custom-event-broadcaster</span></span></code></pre><p>Die ersten vier Zeilen beinhalten die imports der Kernbibliothek React und die Elemente von Storybook. Das Addon benötigt eine ID um sich aufzubauen. In dem Callback der <em>register</em>-Funktion hat man nun die Möglichkeit <a href="https://storybook.js.org/docs/react/addons/addon-types#ui-based-addons">drei Hauptelemente</a> zu erweitern:</p><ul><li><a href="https://derkuba.de/content/posts/1021/component-lib-storybook/">das Panel</a> zu gestalten.</li><li>die Toolbar</li><li>die Tabs</li></ul><p>In unserem Fall erweitern wir das Panel. In den Zeilen 14-16 sehen wir die Storybook-Panelkomponente. Im Bauch dieser Komponente beginnt unsere grüne Wiese. Dort platzieren wir das DIV mit Hello-World.</p><h4 id="addon-im-einsatz" tabindex="-1">Addon im Einsatz <a class="direct-link" href="#addon-im-einsatz">#</a></h4><p>Wir haben jetzt eine erste lauffähige Version. Doch wie bekommen wir diese nun zu sehen. Ich habe dafür mein bestehendes <a href="https://github.com/derKuba/stenciljs-tutorial/tree/main/component-lib">Storybook-Projekt</a> genutzt. Aber jedes andere bestehende Storybook-Projekt ist dafür geeignet.</p><p>Um das Addon nicht auf NPM zu packen und es erstmal lokal zu testen, gibt es einen Trick: <strong>npm link</strong>.</p><p>Man linkt das Addon-Projekt mit dem bestehenden Projekt. Dafür muss man jeweils im Addonprojekt und im &quot;Zielprojekt&quot; einen npm Befehl ausführen.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">//addonverzeichnis</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token punctuation">(</span>sudo<span class="token punctuation">)</span> <span class="token function">npm</span> <span class="token function">link</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">// im Zielverzeichnis</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token punctuation">(</span>sudo<span class="token punctuation">)</span> <span class="token function">npm</span> <span class="token function">link</span> <span class="token punctuation">[</span>NAME IM PACKAGE.JSON<span class="token punctuation">]</span></span></code></pre><p>Ich habe sudo in Klammern geschrieben, weil es auf meiner Kiste nicht funktioniert. Auf anderen Rechnern soll es auch ohne funktionieren. Einfach mal ausprobieren.</p><p>Jetzt muss das Addon nur noch im Zielprojekt in der Storybook-Konfiguration eingetragen werden.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token comment">// .storybook/main.js</span></span><br><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    stories<span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">        <span class="token string">"../src/**/*.stories.mdx"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token string">"../src/**/*.stories.@(js|jsx|ts|tsx)"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    addons<span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">        <span class="token string">"@storybook/addon-links"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token string">"@storybook/addon-essentials"</span><span class="token punctuation">,</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">        <span class="token comment">// einfach unter die eingetragenen Addons hinzufügen</span></span><br><span class="highlight-line">        <span class="token string">"NAME-DES_ADDONS/dist"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre><p>Wenn man nun das Zielprojekt startet, sollte man in jeder Story ein drittes Paneltab sehen, in dem Hello World steht. Durch das Watchskript sieht man nun auch jede Änderung am Addonquellcode direkt beim Neuladen der Seite. Ein Traum zum Entwickeln.</p><p>Jetzt steht euren Ideen nichts mehr im Weg.</p><h4 id="ver%C3%B6ffentlichung" tabindex="-1">Veröffentlichung <a class="direct-link" href="#ver%C3%B6ffentlichung">#</a></h4><p><a href="https://storybook.js.org/docs/react/addons/addon-catalog">https://storybook.js.org/docs/react/addons/addon-catalog</a><br><a href="https://storybook.js.org/addons/storybook-addon-custom-event-broadcaster/">https://storybook.js.org/addons/storybook-addon-custom-event-broadcaster/</a></p><hr><ul class="post-navigation"><li>Vorheriger Artikel: <a href="/content/posts/1021/stencil-builds-for-using-component-lib/">Verwendung der Component Library aus dem StencilJS Build</a></li></ul></div></div></div></div></section><footer class="footer"><hr><div class="content has-text-centered"><p>der_kuba - 2021 - <a href="/content/impressum.html">Impressum</a> - <a href="/content/datenschutz.html">Datenschutzerklärung</a></p></div></footer></body></html>