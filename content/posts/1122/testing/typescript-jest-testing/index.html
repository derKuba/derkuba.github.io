<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Jest Testing mit Typescript: Das kleine Einmaleins</title><meta name="description" content="Die ersten Tests"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link href="/template/css/prism.css" rel="stylesheet"><link rel="stylesheet" href="/template/css/bulma.min.css"><link rel="stylesheet" href="/template/css/custom.css"><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="der_kuba"><link rel="alternate" href="/feed/feed.json" type="application/json" title="der_kuba"><script>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,a=document.getElementById(t);e.classList.toggle("is-active"),a.classList.toggle("is-active")})})});</script></head><body><header><div class="container"><nav class="navbar is-transparent"><div class="navbar-brand"><a class="navbar-item navbar-brand__title" href="/">der_kuba </a><a class="navbar-item" href="https://github.com/derKuba">@Github </a><a class="navbar-item" href="https://twitter.com/der_kuba">@Twitter</a><div class="navbar-burger" data-target="navigation-items"><span></span> <span></span> <span></span></div></div><div id="navigation-items" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home </a><a class="navbar-item" href="/posts/">Archive </a><a class="navbar-item" href="/content/about/">About Me </a><a class="navbar-item" href="/content/impressum.html">Impressum </a><a class="navbar-item" href="/content/datenschutz.html">Datenschutzerklärung</a></div></div></nav></div></header><section class="section"><div class="container"><div class="columns is-centered"><div class="column is-8"><h1 class="title is-3">Jest Testing mit Typescript: Das kleine Einmaleins</h1><div class="post-detail__tags"><h3 class="subtitle is-6"><time datetime="2022-11-21">21 Nov 2022</time></h3><div class="tags"><a href="/tags/test/" class="post-tag"><span class="tag is-black">Test </span></a><a href="/tags/typescript/" class="post-tag"><span class="tag is-primary">Typescript</span></a></div></div><div class="content post_detail__content"><p>Dieser Artikel schließt an den vorherigen Artikel an. Nachdem ein lauffähiges Test-Setup erarbeitet wurde, folgen in diesem Tutorial weitere Testfälle.</p><h3 id="zus%C3%A4tzliche-einstellungen" tabindex="-1">Zusätzliche Einstellungen <a class="direct-link" href="#zus%C3%A4tzliche-einstellungen">#</a></h3><h4 id="fehlende-types" tabindex="-1">Fehlende Types <a class="direct-link" href="#fehlende-types">#</a></h4><p>Bevor es mit der eigentlichen Implementierung los geht, werden noch ein paar Konfigurationen am aktuellen Setup vorgenommen. Damit der Compiler aufhört zu meckern werden für <em>Jest</em> noch die Types installiert:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">npm</span> i <span class="token parameter variable">-D</span> @types/jest</span></code></pre><h4 id="coverage" tabindex="-1">Coverage <a class="direct-link" href="#coverage">#</a></h4><p>Damit man sieht wie viel Code getestet wurde, wird noch die Code-Coverage ausgegeben.<br>Dafür muss die <em>jest.config.js</em> um einige Zeilen erweitert werden:</p><pre class="language-json"><code class="language-json"><span class="highlight-line"><span class="token comment">// jest.config.js</span></span><br><span class="highlight-line">    ...</span><br><span class="highlight-line">    coverageDirectory<span class="token operator">:</span> <span class="token string">"coverage"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    coverageReporters<span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">    <span class="token string">"json"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token string">"text"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token string">"html"</span></span><br><span class="highlight-line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span></code></pre><p>Es werden die Speicherort und die Darstellungsart der Coverage eingestellt. <em>json</em> erzeugt eine Json-Datei ( es lohnt nicht wirklich ein Blick da rein). <em>text</em> gibt die Coverage auf der Konsole aus und <em>html</em> zaubert eine sehr empfehlenswerte und übersichtliche Webseite.</p><p>Um die Generierung anzustoßen wird noch die <em>package.json</em> um ein keines Skript erweitert:</p><pre class="language-json"><code class="language-json"><span class="highlight-line"> <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"jest"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token property">"test:coverage"</span><span class="token operator">:</span> <span class="token string">"jest --coverage"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span></code></pre><p>Führt man es aus, erscheint ein Ordner <em>coverage</em>.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">npm</span> run test:coverage</span></code></pre><h4 id="testf%C3%A4lle" tabindex="-1">Testfälle <a class="direct-link" href="#testf%C3%A4lle">#</a></h4><p>Damit es was zum Testen gibt, wird eine kleine Klasse geschrieben. Anhand dieser Klasse zeige ich einige Testfälle:</p><ul><li>Umgang mit externen Libs</li><li>API-Aufruf</li><li>Rendern von HTML</li><li>Testen mit einer Schleife</li></ul><p>Damit wird die Grundlagen für sehr viele Tests erlernt.</p><h5 id="externe-libs" tabindex="-1">Externe libs <a class="direct-link" href="#externe-libs">#</a></h5><p>Als externe Bibliotheken werden <a href="https://github.com/node-fetch/node-fetch">node-fetch</a> und <a href="https://github.com/uuidjs/uuid#readme">UUID</a> verwendet. Ersteres ist eine HTTP-Client Bibliothek und zweiteres ein Tool, um eine eindeutige ID zu generieren.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">npm</span> i <span class="token parameter variable">-D</span> node-fetch uuiid</span><br><span class="highlight-line"></span><br><span class="highlight-line">// zusätzlich noch ein paar passende Types:</span><br><span class="highlight-line"><span class="token function">npm</span> <span class="token function">install</span> --save-dev @types/node-fetch@2.x</span></code></pre><br><h4 id="implementierung" tabindex="-1">Implementierung <a class="direct-link" href="#implementierung">#</a></h4><h5 id="die-klassenh%C3%BClle" tabindex="-1">Die Klassenhülle <a class="direct-link" href="#die-klassenh%C3%BClle">#</a></h5><p>Die zu testende Logik wird in eine Klasse gepackt:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token keyword">as</span> uuidv4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"uuid"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">class</span> <span class="token class-name">Fun</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">private</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">const</span> random <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> random <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"odd"</span> <span class="token operator">:</span> <span class="token string">"even"</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Die Datei <em>fun.ts</em> importiert die zwei zuvor beschriebenen Bibliotheken. Die Klasse heißt <em>Fun</em> und besitzt ein Attribut <em>id</em>. Dieses Attribut wird im Konstruktor nach dem Zufallsprinzip mit den Zeichenketten <em>odd</em> oder <em>even</em> befüllt. Es dient als Beispiel zum Testen, wenn man keinen Einfluss auf den Inhalt hat.</p><h4 id="die-methoden" tabindex="-1">Die Methoden <a class="direct-link" href="#die-methoden">#</a></h4><p>Es folgen nun einige einfache Methoden.</p><p>Es wird das Attribut <em>ID</em> ausgegeben:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token function">printId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Mithilfe der Bibliothek <em>uuid</em> wird eine zufällige UUID erzeugt:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token function">createUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">kuba_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Das Summieren zweier Zahlen wird abgebildet:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Es wird eine lange Zeichenkette zurückgegeben und simuliert das Erzeugen von HTML:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token function">renderHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">,</span> name <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br><span class="highlight-line">          &lt;html></span><br><span class="highlight-line">              &lt;head></span><br><span class="highlight-line">                  &lt;title></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/title></span><br><span class="highlight-line">              &lt;/head></span><br><span class="highlight-line">              &lt;body></span><br><span class="highlight-line">                  Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><br><span class="highlight-line">              &lt;/body></span><br><span class="highlight-line">          &lt;/html></span><br>      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Ein API-Call wird ausgeführt. Als URL habe ich mich aus einer langen Liste von freien <a href="https://mixedanalytics.com/blog/list-actually-free-open-no-auth-needed-apis/">APIs</a> bedient. Es spielt auch keine Rolle was zurückgegeben wird. In einem Unit-Test sollte man vermeiden irgendwelche Requests abzusetzen!</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token keyword">async</span> <span class="token function">fetchCharacter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://randomuser.me/api/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Zu guter Letzt muss die Klasse noch exportiert werden:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> Fun<span class="token punctuation">;</span></span></code></pre><h4 id="fertige-klasse" tabindex="-1">Fertige Klasse <a class="direct-link" href="#fertige-klasse">#</a></h4><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token keyword">as</span> uuidv4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"uuid"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">import</span> fetch <span class="token keyword">from</span> <span class="token string">"node-fetch"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">class</span> <span class="token class-name">Fun</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">private</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">const</span> random <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> random <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"odd"</span> <span class="token operator">:</span> <span class="token string">"even"</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token function">printId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token function">createUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">kuba_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token function">renderHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">,</span> name <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br>        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br><span class="highlight-line">            &lt;html></span><br><span class="highlight-line">                &lt;head></span><br><span class="highlight-line">                    &lt;title></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/title></span><br><span class="highlight-line">                &lt;/head></span><br><span class="highlight-line">                &lt;body></span><br><span class="highlight-line">                    Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><br><span class="highlight-line">                &lt;/body></span><br><span class="highlight-line">            &lt;/html></span><br>        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token keyword">async</span> <span class="token function">fetchCharacter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://randomuser.me/api/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">            method<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">            headers<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">                Accept<span class="token operator">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">            <span class="token keyword">return</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> Fun<span class="token punctuation">;</span></span></code></pre><p>Um die einzelnen Methoden mal auszuprobieren, habe ich noch eine kleine Ausführungsmain-Datei erstellt:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token keyword">import</span> Fun <span class="token keyword">from</span> <span class="token string">"./fun"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">const</span> fun <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span><span class="token function">printId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span><span class="token function">createUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span><span class="token function">renderHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">"Hello World"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"Der Kuba"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> fun<span class="token punctuation">.</span><span class="token function">fetchCharacter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h3 id="tests" tabindex="-1">TESTS <a class="direct-link" href="#tests">#</a></h3><p>Die Datei <em>fun.test.ts</em> enthält den üblichen bdd-Testskeleton:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token keyword">import</span> Fun <span class="token keyword">from</span> <span class="token string">"./fun"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"Fun"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// für jeden Tests gibts immer eine neue und saubere Instanz der Klasse</span></span><br><span class="highlight-line">    <span class="token keyword">let</span> fun<span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        fun <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><br><h4 id="test-printid" tabindex="-1">Test printId <a class="direct-link" href="#test-printid">#</a></h4><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should printId"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">const</span> expected <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"odd"</span><span class="token punctuation">,</span> <span class="token string">"even"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token function">expect</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span><span class="token function">printId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Die ID der Klasse wird per Zufall gesetzt und besteht aus einem von zwei Werten. Es wird ein Array erstellt, das aus den beiden möglichen Werten enthält. Im Test überprüfe ich anhand der Methode <em>toContain</em> den Inhalt des Arrays. Achtung. Das ist nur eine simple Möglichkeit. Eine weitere wäre <em>Math.random</em> zu überschreiben und jeweils die ID zu testen. Wie man solche Funktionen mockt, zeige ich weiter unten.</p><br><h4 id="test-sum" tabindex="-1">Test sum <a class="direct-link" href="#test-sum">#</a></h4><pre class="language-ts"><code class="language-ts"><span class="highlight-line">test<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span><br><span class="highlight-line">    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">".add(%i, %i)"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function">expect</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Das Produkt zweier Zahlen zu testen ist nicht mit einem Aufruf getan. Oftmals möchte man Randbereiche und andere Extremen testen (Ja, ich habe es nicht getan :-) ). Man könnte den <em>it</em>-Block in eine Schleife setzen und so verschiedene Kombinationen testen. <em>Jest</em> bietet zum Glück einen eigenen Mechanismus dafür: <em>it.each</em>. Es wird zweidimensionales Array übergeben und dann werden die Variablen <em>a</em>, <em>b</em> und expected auf die Werte innerhalb des Array gemapped:</p><p>Testdurchlauf 1 mappt:<br>a: [0][0]<br>b: [0][1]<br>expected: [0][2]</p><p>Testdurchlauf 2 mappt:<br>a: [1][0]<br>b: [1][1]<br>expected: [1][2]</p><p>....</p><p>Alternativ kann man direkt die Variablen zuweisen:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line">test<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span><br><span class="highlight-line">    <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">".add($a, $b)"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Oder man übergibt eine Template-String-Tabelle:</p><pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span>each<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br><span class="highlight-line">    a    | b    | expected</span><br><span class="highlight-line">    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><br><span class="highlight-line">    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">3</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><br><span class="highlight-line">    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">3</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">"returns $expected when $a is added $b"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br><span class="highlight-line">    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><br><h4 id="test-renderhtml" tabindex="-1">Test renderHTML <a class="direct-link" href="#test-renderhtml">#</a></h4><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token comment">// bevor der Test jemals ausgeführt wurde</span></span><br><span class="highlight-line"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should make a snapshot of renderHTML"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function">expect</span><span class="token punctuation">(</span></span><br><span class="highlight-line">        fun<span class="token punctuation">.</span><span class="token function">renderHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">"Jest"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"jacob"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchInlineSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Um einen Zustand von HTML zu speichern, bietet <em>Jest</em> mehrere Möglichkeiten. Man könnte <em>toBe</em> verwenden und dann hart HTML als String vergleichen. Aber es gibt auch eine galantere Alternative. Im Werkzeugkasten von <em>Jest</em> liegen noch <em>toMatchInlineSnapshot</em> und <em>toSnapshot</em>. Aber warum möchte man das überhaupt tun?<br>Die drei beliebten Frameworks wie <em>Angular</em>, <em>React</em> oder <em>Vue</em> erzeugen HTML und manipulieren es auch. Wie teste man nun eine Methode, die z.B. einen Wert ändert oder vielleicht einen ganzen Block austauscht. Zu <em>jQuery</em>-Zeiten hat man den gewünschten Zustand einmal hergestellt, kopiert und dann im Test verglichen. Teilweise musste man die gewünschten Knoten im HTML-Baum ansteuern und die Werte jeweils überprüfen. Man schreibt viel Code, für wenig Testinhalt.<br><em>Jest</em> bietet die Möglichkeit das gewünschte Abbild zu speichern. Einmal kann man es statisch im Code über <em>toMatchInlineSnapshot</em> und einmal gibt es die Möglichkeit den Zustand in eine Datei zu speichern, in <em>git</em> einzuchecken und dann beim nächsten Aufruf als Vergleichsreferenz zu verwenden. Man wird über eine Änderung des HTMLs via scheiternden Tests informiert und kann dann, sollte die Änderung gewünscht sein, einfach den Inhalt überschreiben.</p><p>Im oberen Test mit <em>toMatchInlineSnapshot</em> wird zunächst parameterlos gestartet. Nachdem man den Test einmal ausgeführt hat, schreibt <em>Jest</em> den Inhalt als Parameter hin zu.</p><pre class="language-html"><code class="language-html"><span class="highlight-line">// nach dem ersten Aufruf it("should make a snapshot of renderHTML", () => {</span><br><span class="highlight-line">expect(fun.renderHTML({ title: "Jest", name: "jacob" }))</span><br><span class="highlight-line">.toMatchInlineSnapshot(` "</span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Jest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">        Hello jacob</span><br><span class="highlight-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">"`); });</span></code></pre><p>Beim zweiten Aufruf gibt es nun auch das statische HTML. Jetzt kann natürlich das HTML beliebig groß sein und die Testdatei unnötig aufblähen. Dann wählt man <em>.toMatchSnapshot</em> und es wird in eine eigene Datei ausgelagert:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token comment">// bevor der Test jemals ausgeführt wurde</span></span><br><span class="highlight-line"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should make a snapshot of renderHTML"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function">expect</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span><span class="token function">renderHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">"Jest"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"jacob"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><br><h4 id="test-createuuid" tabindex="-1">Test createUUID <a class="direct-link" href="#test-createuuid">#</a></h4><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should create a uuid"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">const</span> uuid <span class="token operator">=</span> fun<span class="token punctuation">.</span><span class="token function">createUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token function">expect</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">"kuba_42"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Dieser Tests sieht sehr simpel aus und ist es natürlich auch. Allerdings macht dies nur etwas Vorarbeit möglich. Im oberen Teil der Datei verbirgt sich noch etwas Code:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line">jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"uuid"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> originalModule <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">requireActual</span><span class="token punctuation">(</span><span class="token string">"uuid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    __esModule<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token operator">...</span>originalModule<span class="token punctuation">,</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token function-variable function">v4</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"42"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">import</span> Fun <span class="token keyword">from</span> <span class="token string">"./fun"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"Fun"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">.</span></span><br><span class="highlight-line"></span></code></pre><p>Hier geschieht die eigentliche Magie. Mithilfe von <em>jest.mock</em> wird der Import des <em>uuid</em>-Moduls &quot;gemockt&quot;. Mocken heißt in diesem Kontext, das Überschreiben des Moduls, bzw. das Vorgaukeln einer anderen Implementierung. Man macht das weil man getrennt von der Logik des importierten Moduls losgelöst seine eigene Unit testen möchte. Der Code holt sich die restliche Implementierung des Moduls und überschreibt nur die Erzeugung der UUID. Die neue Implementierung liefert nun immer die Antwort auf alles: 42.</p><p>Alternativ könnte man natürlich eine UUID erzeugen und dann quasi die Bibliothek testen. Dafür hat <em>Jest</em> einen Regex-Matcher im Angebot:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token function">xit</span><span class="token punctuation">(</span><span class="token string">"should create a uuid"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">const</span> uuid <span class="token operator">=</span> fun<span class="token punctuation">.</span><span class="token function">createUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token function">expect</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"kuba_"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span></span><br><span class="highlight-line">        <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12}\b</span><span class="token regex-delimiter">/</span></span></span><br><span class="highlight-line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Für die Ausführung muss man noch das X in <em>xit</em> entfernen, da der Test deaktiviert ist.</p><h4 id="test-fetchcharacter" tabindex="-1">Test fetchCharacter <a class="direct-link" href="#test-fetchcharacter">#</a></h4><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should send a request"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">const</span> character <span class="token operator">=</span> <span class="token keyword">await</span> fun<span class="token punctuation">.</span><span class="token function">fetchCharacter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token function">expect</span><span class="token punctuation">(</span>character<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">"kuba"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Wie der vorherige Test ist dieser wieder sehr simpel. Natürlich geht das auch wieder nur durch Vorarbeit im oberen Teil der Testdatei:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token keyword">const</span> myPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"kuba"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"node-fetch"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">const</span> originalModule <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">requireActual</span><span class="token punctuation">(</span><span class="token string">"uuid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        __esModule<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token operator">...</span>originalModule<span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">            ok<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><br><span class="highlight-line">            <span class="token function-variable function">json</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> myPromise<span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Zunächst erzeugen wir ein simples <em>Promise</em>, das den String <em>&quot;kuba&quot;</em> zurückliefert. Im nächsten Block wird die <em>node-fetch</em>-Bibliothek gemockt und der Aufruf von <em>fetch</em> überschrieben. Es liefert nun die für die Implementierung benötigten Werte <em>ok</em> und <em>json()</em>. Da der Wert nun fest gesetzt ist, kann dieser Überprüft werden.</p><h3 id="fazit" tabindex="-1">Fazit <a class="direct-link" href="#fazit">#</a></h3><p>Damit haben wir nun die Fähigkeiten erlangt sehr viele Testfälle zu testen und einem Einstieg in das Reich der Test-Coverage steht nichts mehr im weg. Natürlich gibt es noch viele weitere Möglichkeiten Tests zu schreiben.</p><p>Bei weiterem Interesse zum Thema Testing empfehle ich meine Artikel vom letzten Jahr:</p><p><a href="https://derkuba.de/tags/jest/">https://derkuba.de/tags/jest/</a><br><a href="https://derkuba.de/content/posts/stenciljs/address-app-e2e/">https://derkuba.de/content/posts/stenciljs/address-app-e2e/</a></p><p>Der Code hierzu liegt auf <a href="https://github.com/derKuba/fun-with-jest">Github</a>.</p><p>Ihr habt Fragen oder Anregungen? Schreibt mir bei <a href="https://twitter.com/der_kuba">Twitter</a>.<br><br><br>Tausend Dank fürs Lesen!</p><p>Kuba</p><hr><ul class="post-navigation"><li>Vorheriger Artikel: <a href="/content/posts/1122/testing/typescript-jest-setup/">Jest Testing Setup für Typescript</a></li></ul></div></div></div></div></section><footer class="footer"><hr><div class="content has-text-centered"><p>der_kuba - 2021 - <a href="/content/impressum.html">Impressum</a> - <a href="/content/datenschutz.html">Datenschutzerklärung</a></p></div></footer></body></html>