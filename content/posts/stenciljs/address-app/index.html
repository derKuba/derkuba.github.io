<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>StencilJS-Tutorial: das Adressbuch</title><meta name="description" content="Alles Gelernte zusammengefasst in einer App"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link href="/template/css/prism.css" rel="stylesheet"><link rel="stylesheet" href="/template/css/bulma.min.css"><link rel="stylesheet" href="/template/css/custom.css"><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="der_kuba"><link rel="alternate" href="/feed/feed.json" type="application/json" title="der_kuba"><script>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,a=document.getElementById(t);e.classList.toggle("is-active"),a.classList.toggle("is-active")})})});</script></head><body><header><div class="container"><nav class="navbar is-transparent"><div class="navbar-brand"><a class="navbar-item navbar-brand__title" href="/">der_kuba </a><a class="navbar-item" href="https://github.com/derKuba">@Github </a><a class="navbar-item" href="https://twitter.com/der_kuba">@Twitter</a><div class="navbar-burger" data-target="navigation-items"><span></span> <span></span> <span></span></div></div><div id="navigation-items" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home </a><a class="navbar-item" href="/posts/">Archive </a><a class="navbar-item" href="/content/about/">About Me </a><a class="navbar-item" href="/content/impressum.html">Impressum </a><a class="navbar-item" href="/content/datenschutz.html">Datenschutzerklärung</a></div></div></nav></div></header><section class="section"><div class="container"><div class="columns is-centered"><div class="column is-8"><h1 class="title is-3">StencilJS-Tutorial: das Adressbuch</h1><div class="post-detail__tags"><h3 class="subtitle is-6"><time datetime="2021-08-05">05 Aug 2021</time></h3><div class="tags"><a href="/tags/stenciljs/" class="post-tag"><span class="tag is-black">Stenciljs</span></a></div></div><div class="content post_detail__content"><p>Die bisherigen Tutorials haben jetzt alle nötigen Bausteine von StencilJS vorgestellt, die wir für unsere Adressbuch-Applikation benötigen. In diesem Artikel werden die diese nun verwendet, um ein funktionierendes Adressbuch zu bauen:</p><table><thead><tr><th>Baustein</th><th style="text-align:center">Funktion</th><th style="text-align:center">Verwendung</th></tr></thead><tbody><tr><td>Router</td><td style="text-align:center">Steuert den Seitenverlauf und die Navigation</td><td style="text-align:center"><a href="https://derkuba.de/content/posts/stenciljs/routing/">weiterleitung auf /, /contacts, /addresslist</a></td></tr><tr><td>Class-Komponenten</td><td style="text-align:center">Aufbau, Struktur und Funktion einer Komponente</td><td style="text-align:center"><a href="https://derkuba.de/content/posts/stenciljs/erste-stencil-komponente/">Visuelle Elemente mitsamt Interaktion: Input-Felder, Buttons, Seitenrahmen</a></td></tr><tr><td>Functional-Komponenten</td><td style="text-align:center">Schlanke Alternative zur Class-Komponente</td><td style="text-align:center"><a href="https://derkuba.de/content/posts/stenciljs/functional-component/">Beispielhafte Verwendung</a></td></tr><tr><td>Store</td><td style="text-align:center">Applikationszustand</td><td style="text-align:center"><a href="https://derkuba.de/content/posts/stenciljs/stores/">Datenaustausch zwischen den Komponenten</a></td></tr><tr><td>Entwicklerwerkzeuge</td><td style="text-align:center">Einheitlicher Code mit Qualitätsanspruch</td><td style="text-align:center"><a href="https://derkuba.de/content/posts/stenciljs/entwicklerwerkzeuge/">Kleine, aber feine Helfer</a></td></tr></tbody></table><p>Die Applikation ist aufgebaut wie im folgenden Bild beschrieben:<br><img src="/content/img/stenciljs-tutorial/address-app.png" alt="adress app" title="das Addressbuch"></p><div class="has-text-right image-subline">Bild 1: Die Address-App</div><br>Es gibt 4 Routen, die auf 2 Komponenten zeigen. Die ersten beiden Routen (<strong>&quot;/&quot;</strong> und <strong>&quot;/address-list&quot;</strong>) zeigen auf die <em>kuba-home</em>-Komponente, die die Liste darstellt. Die nächsten beiden Routen (<strong>&quot;/contact&quot;</strong> und <strong>&quot;/contact/:id&quot;</strong>) zeigen auf die <em>kuba-address-form</em>-Komponente, die das Eingabeformular darstellt.<p></p><h4 id="die-kontakt-liste" tabindex="-1">Die Kontakt-Liste <a class="direct-link" href="#die-kontakt-liste">#</a></h4><p>Die grundlegende Funktion der Listenseite ist die Anzeige aller bestehenden Kontakte. Dafür ist diese Komponente an den Store angebunden, der diese Kontakte beinhaltet. Zusätzlich gibt es die Möglichkeit auf die Detailseite zu kommen. Es gibt eine &quot;Neu-Anlegen-Seitenleeres&quot; mitsamt leeren Formular und eine &quot;Editier-Seite&quot; mit vorausgefülltes Formular. Die Komponenten sind so geschachtelt, dass die <em>kuba-home</em>, die <em>kuba-list</em> inkludiert und diese wiederum, die <a href="https://derkuba.de/content/posts/stenciljs/tabellen-komponente/"><em>kuba-table-options</em>-Komponente</a> verwendet.</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token comment">// kuba-home.tsx</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> Host<span class="token punctuation">,</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@stencil/core"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    tag<span class="token operator">:</span> <span class="token string">"kuba-home"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    styleUrl<span class="token operator">:</span> <span class="token string">"kuba-home.css"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    shadow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">KubaHome</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">            <span class="token operator">&lt;</span>Host<span class="token operator">></span></span><br><span class="highlight-line">                <span class="token operator">&lt;</span>h1<span class="token operator">></span>Kuba<span class="token operator">-</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></span><br><span class="highlight-line">                <span class="token operator">&lt;</span>kuba<span class="token operator">-</span>list<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>kuba<span class="token operator">-</span>list<span class="token operator">></span></span><br><span class="highlight-line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Host<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Die KubaHome-Komponente dient als Hülle für die Liste. Man hat hier noch zusätzliche Platz für Texte oder zum Styling. Darauf habe ich aus Übersichtsgründen verzichtet.<br>Der interessante Teil ist die <em>kuba-list</em>-Komponente:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> Host<span class="token punctuation">,</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@stencil/core"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">import</span> addressStore <span class="token keyword">from</span> <span class="token string">"../../store/address-store"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    tag<span class="token operator">:</span> <span class="token string">"kuba-list"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    styleUrl<span class="token operator">:</span> <span class="token string">"kuba-list.css"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    shadow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">KubaList</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function-variable function">deleteContact</span> <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">const</span> filteredArray <span class="token operator">=</span> addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span></span><br><span class="highlight-line">            <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>id <span class="token operator">!==</span> id</span><br><span class="highlight-line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        addressStore<span class="token punctuation">.</span>contacts <span class="token operator">=</span> filteredArray<span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">            <span class="token operator">&lt;</span>Host<span class="token operator">></span></span><br><span class="highlight-line">                <span class="token operator">&lt;</span>stencil<span class="token operator">-</span>route<span class="token operator">-</span>link url<span class="token operator">=</span><span class="token string">"/contact"</span> activeClass<span class="token operator">=</span><span class="token string">"link-active"</span><span class="token operator">></span></span><br><span class="highlight-line">                    Neuer Kontakt</span><br><span class="highlight-line">                <span class="token operator">&lt;</span><span class="token operator">/</span>stencil<span class="token operator">-</span>route<span class="token operator">-</span>link<span class="token operator">></span></span><br><span class="highlight-line">                <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line"></span><br><span class="highlight-line">                <span class="token operator">&lt;</span>kuba<span class="token operator">-</span>table<span class="token operator">-</span>options</span><br><span class="highlight-line">                    <span class="token keyword">delete</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>deleteContact<span class="token punctuation">}</span></span><br><span class="highlight-line">                    key<span class="token operator">=</span><span class="token punctuation">{</span>addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">.</span>length<span class="token punctuation">}</span></span><br><span class="highlight-line">                <span class="token operator">></span></span><br><span class="highlight-line">                    <span class="token operator">&lt;</span>kuba<span class="token operator">-</span>table<span class="token operator">-</span>options<span class="token operator">-</span>head<span class="token operator">></span></span><br><span class="highlight-line">                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">"id"</span> <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line">                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">"name"</span> <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line">                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">"vorname"</span> <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line">                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">"aktion"</span> <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>kuba<span class="token operator">-</span>table<span class="token operator">-</span>options<span class="token operator">-</span>head<span class="token operator">></span></span><br><span class="highlight-line">                    <span class="token operator">&lt;</span>kuba<span class="token operator">-</span>table<span class="token operator">-</span>options<span class="token operator">-</span>body<span class="token operator">></span></span><br><span class="highlight-line">                        <span class="token punctuation">{</span>addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span></span><br><span class="highlight-line">                            <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token punctuation">{</span>row<span class="token punctuation">.</span>id<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span></span><br><span class="highlight-line">                            <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token punctuation">{</span>row<span class="token punctuation">.</span>firstname<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span></span><br><span class="highlight-line">                            <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token punctuation">{</span>row<span class="token punctuation">.</span>lastName<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span></span><br><span class="highlight-line">                            <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token punctuation">{</span>row<span class="token punctuation">.</span>id<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span></span><br><span class="highlight-line">                        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><br><span class="highlight-line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>kuba<span class="token operator">-</span>table<span class="token operator">-</span>options<span class="token operator">-</span>body<span class="token operator">></span></span><br><span class="highlight-line">                <span class="token operator">&lt;</span><span class="token operator">/</span>kuba<span class="token operator">-</span>table<span class="token operator">-</span>options<span class="token operator">></span></span><br><span class="highlight-line">                <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Host<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Herzstück der Komponente ist die <a href="https://derkuba.de/content/posts/stenciljs/tabellen-komponente/">Tabellen-Komponte</a>. In den Zeilen 29-34 sieht man wie der Tabellenkopf definiert wird. Es werden 4 Zeilen deklariert (ID, Name, Vorname und Aktion). Das Aktionsfeld beinhaltet Operatoren für die Zeile ( Löschen und Editieren). Die Zeile 20-22 zeigen den Link auf die leere Formularseite.<br>Der Kopf der Tabellen-Komponente beinhaltet noch 2 Props. Das <em>delete</em>-Property ist ein Callback, das gefeuert wird, sobald man auf die Aktionstaste &quot;löschen&quot; klickt. Das Key-Property wird benötigt, damit StencilJS merkt, dass sich etwas geändert hat und ein Rerender ansteuert. Ohne das Key, müsste man vor- und zurücknavigieren, um ein rerender zu erzwingen. Die &quot;deleteContact&quot;-Funktion (Zeile 11-16) manipuliert das Store-Objekt und löscht anhand der übergebene ID den Kontakt aus dem Store-Listen-Objekt. Die Weiterleitung auf das Editier-Formular geschieht über die übergebene ID an Zeile.</p><h4 id="das-adress-formular" tabindex="-1">Das Adress-Formular <a class="direct-link" href="#das-adress-formular">#</a></h4><p>Die Adress-Komponente hat zwei Einstiegsmodi. Einmal mit übergebener ID und einmal ohne. In Abhängigkeit von dieser ID befinden wir uns auf der &quot;neue Kontakt&quot;-Seite oder auf der &quot;Editier-Seite&quot;. Damit eingehend haben wir zwei Grundfunktionen:</p><ol><li>Speichern der eingegebenen oder veränderten Daten</li><li>Anzeigen bestehender Daten im Formular</li></ol><p><strong>1. Speichern der eingegebenen Daten:</strong><br>In meinem Beispielprojekt verwende ich nur 3 Eingabefelder. Mehr Felder können mit etwas Copy&amp;Paste hinzugefügt werden. Für diese 3 Felder habe ich <em>States</em> angelegt:</p><pre class="language-tsx"><code class="language-tsx"><span class="highlight-line">  @<span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">)</span> addressState<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  @<span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">)</span> firstNameState<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  @<span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">)</span> lastNameState<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token comment">// Zusatzfeld ID, das aber nicht angezeigt wird</span></span><br><span class="highlight-line">  @<span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">)</span> idState<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span></code></pre><p>Die States finden sich im HTML wieder. Jedes Feld wird von einem Input repräsentiert. Die Input-Komponenten <a href="https://derkuba.de/content/posts/stenciljs/erste-stencil-komponente/"><strong>kuba-input</strong></a> und <a href="https://derkuba.de/content/posts/stenciljs/functional-component/"><strong>KubaInputFunctional</strong></a> wurden in den vorherigen Tutorials gebaut.</p><pre class="language-typescript"><code class="language-typescript"><span class="highlight-line"><span class="token operator">&lt;</span>kuba<span class="token operator">-</span>input</span><br><span class="highlight-line">    componentId<span class="token operator">=</span><span class="token string">"first-name"</span></span><br><span class="highlight-line">    label<span class="token operator">=</span><span class="token string">"Vorname:"</span></span><br><span class="highlight-line">    onInputEvent<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChangeFirstName<span class="token punctuation">}</span></span><br><span class="highlight-line">    value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>firstNameState<span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>kuba<span class="token operator">-</span>input<span class="token operator">></span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token operator">&lt;</span>kuba<span class="token operator">-</span>input</span><br><span class="highlight-line">    componentId<span class="token operator">=</span><span class="token string">"last-name"</span></span><br><span class="highlight-line">    label<span class="token operator">=</span><span class="token string">"Nachname:"</span></span><br><span class="highlight-line">    onInputEvent<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChangeLastName<span class="token punctuation">}</span></span><br><span class="highlight-line">    value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastNameState<span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>kuba<span class="token operator">-</span>input<span class="token operator">></span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token operator">&lt;</span>KubaInputFunctional</span><br><span class="highlight-line">    componentId<span class="token operator">=</span><span class="token string">"street"</span></span><br><span class="highlight-line">    label<span class="token operator">=</span><span class="token string">"Adresse:"</span></span><br><span class="highlight-line">    value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>addressState<span class="token punctuation">}</span></span><br><span class="highlight-line">    type<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"text"</span><span class="token punctuation">}</span></span><br><span class="highlight-line">    setter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChangeAddress<span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>KubaInputFunctional<span class="token operator">></span></span></code></pre><p>Die Attribute der Komponenten sind selbsterklärend. Die einzige Auffälligkeit ist der &quot;Setter&quot;, bzw. das &quot;onInputEvent&quot;. Ersteres ist ein Callback das reingereicht wird, das auf das <em>onInput</em>-Event des HTML-Inputs lauscht. Das &quot;onInputEvent&quot; widerum lauscht auf genau dieses Input-Event, das von der <em>kuba-input</em> gefeuert wird. Beide Funktionen werden bei jedem Tastenanschlag innerhalb des Inputs gefeuert.</p><p>Die eingegebenen Daten müssen, damit sie in der Tabelle auf der ersten Seite angezeigt werden können, in das Store-Objekt geschrieben werden. Dies geschieht in den <em>setter-Funktionen</em>:</p><pre class="language-typescript"><code class="language-typescript"><span class="highlight-line"><span class="token comment">// am Anfang der Datei</span></span><br><span class="highlight-line"><span class="token keyword">import</span> addressStore <span class="token keyword">from</span> <span class="token string">"../../store/address-store"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// innerhalb der Klasse</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// setzen des Vornamens</span></span><br><span class="highlight-line"><span class="token keyword">private</span> <span class="token function-variable function">onChangeFirstName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    detail<span class="token operator">:</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    detail<span class="token operator">:</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">this</span><span class="token punctuation">.</span>firstNameState <span class="token operator">=</span> value<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// setzen des Nachnamens</span></span><br><span class="highlight-line"><span class="token keyword">private</span> <span class="token function-variable function">onChangeLastName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    detail<span class="token operator">:</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    detail<span class="token operator">:</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">this</span><span class="token punctuation">.</span>lastNameState <span class="token operator">=</span> value<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// setzen der Adresse</span></span><br><span class="highlight-line"><span class="token keyword">private</span> <span class="token function-variable function">onChangeAddress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    value<span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">this</span><span class="token punctuation">.</span>addressState <span class="token operator">=</span> value<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre><p>Wie man oben sieht wird einfach der bestehende Wert durch den neuen Wert überschrieben.</p><p><strong>Werte speichern</strong><br>Es existiert ein klassischer Speichern-Button, der <em>onClick</em> eine Funktion ausführt:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token operator">&lt;</span>kuba<span class="token operator">-</span>button handleSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onSubmit<span class="token punctuation">}</span><span class="token operator">></span>speichern<span class="token operator">&lt;</span><span class="token operator">/</span>kuba<span class="token operator">-</span>button<span class="token operator">></span></span></code></pre><p>Diese <em>onSubmit</em>-Funktion teilt sich in zwei Teile. Wie oben beschrieben in <em>Neu</em> und <em>Editieren</em>.<br>Wenn man einen neuen Kontakt anlegt, brauchen wir zum eindeutigen Zuweisen eine ID. Dafür habe ich mir eine Funktion ausgeliehen, die wir als Blackbox-Funktion behandeln (Aufbau und Funktionalität interessieren uns nicht - sie tut was sie soll). Sie wird aufgerufen und gibt uns eine eindeutige Id.</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line"><span class="token comment">// erzeuge eindeutige ID</span></span><br><span class="highlight-line"><span class="token keyword">const</span> uuid <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">create_UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// füge die Inhalte der einzelnen States in ein Objekt.</span></span><br><span class="highlight-line">addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    firstname<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstNameState<span class="token punctuation">,</span></span><br><span class="highlight-line">    lastName<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastNameState<span class="token punctuation">,</span></span><br><span class="highlight-line">    id<span class="token operator">:</span> uuid<span class="token punctuation">,</span></span><br><span class="highlight-line">    address<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addressState<span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// StencilJS triggert ein Neurendern nur bei neuen Objekten</span></span><br><span class="highlight-line">addressStore<span class="token punctuation">.</span>contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">]</span><span class="token punctuation">;</span></span></code></pre><p>Wie der obige Code zeigt, holen wir uns eine ID und fügen anschließend dem Array aus dem Store ein weiteres Objekt hinzu. Die Zeile 13 ist dabei noch interessant. Der Kommentar beschreibt den Grund. Der Store von Stenciljs bekommt die Änderung zwar mit, aber das Framework triggert keinen Rerender. Daher wird eine neue Referenz in <em>addressStore.contacts</em> hinterlegt, bzw. eine Kopie des bestehenden Arrays. Wenn wir nun zurück klicken würden, würden wir einen neuen Antrag in der Tabelle sehen.</p><p><strong>Anzeigen und editieren bestehender Daten:</strong><br>Für die Anzeige und editieren bestehender Daten müssen wir aus der URL den Parameter auslesen. Dabei hilft uns die Router-API. Mithilfe von der Property match vom Typ <em>MatchResults</em>.</p><pre class="language-tsx"><code class="language-tsx"><span class="highlight-line"><span class="token comment">// Klassenproperty</span></span><br><span class="highlight-line">@<span class="token function">Prop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> match<span class="token operator">:</span> MatchResults<span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// Aufruf des Parameters aus dem Pattern /contacts/:id</span></span><br><span class="highlight-line"><span class="token keyword">this</span><span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id</span></code></pre><p>Dies brauchen wir im zweiten Teil der <em>onSubmit</em>-Funktion<br>Wenn in der <em><a href="http://this.match.params.id">this.match.params.id</a></em> eine ID vorhanden ist, befinden wir uns im Editier-Modus und gehen davon aus, dass der Store bereits einen Eintrag mit genau dieser ID enthält. Wir müssen nun an die Stelle im Array iterieren und die Werte ersetzen:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line">addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>contact<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>contact<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">            <span class="token operator">...</span>addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">            firstname<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstNameState<span class="token punctuation">,</span></span><br><span class="highlight-line">            lastName<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastNameState<span class="token punctuation">,</span></span><br><span class="highlight-line">            address<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addressState<span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Gehen wir nun wieder zurück und schauen in die Tabelle. Haben wir andere Werte im Formular eingetippt, spiegelt sich dies nun wieder.</p><p>Für eine bessere Übersicht zeige ich im folgenden die gesamte Funktion:</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line">  <span class="token keyword">private</span> <span class="token function-variable function">onSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token keyword">const</span> uuid <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">create_UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">      addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">        firstname<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstNameState<span class="token punctuation">,</span></span><br><span class="highlight-line">        lastName<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastNameState<span class="token punctuation">,</span></span><br><span class="highlight-line">        id<span class="token operator">:</span> uuid<span class="token punctuation">,</span></span><br><span class="highlight-line">        address<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addressState<span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      addressStore<span class="token punctuation">.</span>contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">]</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>firstNameState <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>lastNameState <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>idState <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>addressState <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>contact<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>contact<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">          addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">            <span class="token operator">...</span>addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">            firstname<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstNameState<span class="token punctuation">,</span></span><br><span class="highlight-line">            lastName<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastNameState<span class="token punctuation">,</span></span><br><span class="highlight-line">            address<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addressState<span class="token punctuation">,</span></span><br><span class="highlight-line">          <span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token punctuation">}</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre><p>Ich habe die Zeilen 13-16 in der obigen Beschreibung ausgelassen. In diesen Zeilen lösche ich die Eingabe nach dem Speichern. Sodass man direkt weiter neue Kontakte hinzufügen kann.</p><p>Für das Anzeigen bestehender Daten verwende ich die StencilJS-Lifecycle Methode <em>connectedCallback</em>. Diese wird genau einmal aufgerufen, beim Initiieren der Klasse. Der Router kümmert sich um das Erzeugen und Abräumen der Klasse und es ist eine geeignete Stelle, um die Daten aus dem Store zu laden und die dazugehörigen States zu setzen. Die Bedingung für das Setzen ist das Vorhandensein der ID in der URL :</p><pre class="language-ts"><code class="language-ts"><span class="highlight-line">  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    addressStore<span class="token punctuation">.</span>contacts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>addressState <span class="token operator">=</span> item<span class="token punctuation">.</span>address<span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>firstNameState <span class="token operator">=</span> item<span class="token punctuation">.</span>firstname<span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>lastNameState <span class="token operator">=</span> item<span class="token punctuation">.</span>lastName<span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>idState <span class="token operator">=</span> item<span class="token punctuation">.</span>id<span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span></code></pre><p>Fertig ist die erste kleine Applikation, die die Anforderungen aus der Einleitung erfüllt. Sie verwendet alle gelernten Bausteine und funktioniert wie gefordert. Natürlich hat sie einige unschöne Abläufe:</p><ul><li>beim Laden der Seite verschwinden alle Daten</li><li>kein Nutzerfeedback, dass etwas gespeichert wurde.</li><li>kein einziger Unit-Test</li><li>allgemein nicht gestyled</li></ul><p>An diesen Macken wollen wir noch arbeiten und das in den kommenden Artikeln.</p><p>Der Code hierzu liegt auf <a href="https://github.com/derKuba/stenciljs-tutorial/releases/tag/1.0.3">Github</a>. Um es auf diesen Stand zu bringen, müsst ihr das Projekt klonen und einmal auf den Tag 1.0.3 auschecken:</p><p>Ihr habt Fragen oder Anregungen? Schreibt mir bei <a href="https://twitter.com/der_kuba">Twitter</a>.<br><br><br>Tausend Dank fürs Lesen!</p><p>Kuba</p><hr><ul class="post-navigation"><li>Nächster Artikel: <a href="/content/posts/stenciljs/jest-intro/">StencilJS-Tutorial: JEST</a></li><li>Vorheriger Artikel: <a href="/content/posts/stenciljs/functional-component/">StencilJS-Tutorial: Functional Component</a></li></ul></div></div></div></div></section><footer class="footer"><hr><div class="content has-text-centered"><p>der_kuba - 2023 - <a href="/content/impressum.html">Impressum</a> - <a href="/content/datenschutz.html">Datenschutzerklärung</a></p></div></footer></body></html>