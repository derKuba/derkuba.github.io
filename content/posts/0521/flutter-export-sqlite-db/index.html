<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>How to export SQlite Database File in Flutter (Android)</title><meta name="description" content="SQlite Database aus der Applikation exportieren unter Android"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link href="/template/css/prism.css" rel="stylesheet"><link rel="stylesheet" href="/template/css/bulma.min.css"><link rel="stylesheet" href="/template/css/custom.css"><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="der_kuba"><link rel="alternate" href="/feed/feed.json" type="application/json" title="der_kuba"><script>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,a=document.getElementById(t);e.classList.toggle("is-active"),a.classList.toggle("is-active")})})});</script></head><body><header><div class="container"><nav class="navbar is-transparent"><div class="navbar-brand"><a class="navbar-item navbar-brand__title" href="/">der_kuba </a><a class="navbar-item" href="https://github.com/derKuba">@Github </a><a class="navbar-item" href="https://twitter.com/der_kuba">@Twitter</a><div class="navbar-burger" data-target="navigation-items"><span></span> <span></span> <span></span></div></div><div id="navigation-items" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home </a><a class="navbar-item" href="/posts/">Archiv </a><a class="navbar-item" href="/content/about/">About Me </a><a class="navbar-item" href="/content/impressum.html">Impressum </a><a class="navbar-item" href="/content/datenschutz.html">Datenschutzerklärung</a></div></div></nav></div></header><section class="section"><div class="container"><div class="columns is-centered"><div class="column is-8"><h1 class="title is-3">How to export SQlite Database File in Flutter (Android)</h1><div class="post-detail__tags"><h3 class="subtitle is-6"><time datetime="2021-05-02">02 May 2021</time></h3><div class="tags"><a href="/tags/flutter/" class="post-tag"><span class="tag is-black">Flutter </span></a><a href="/tags/sqllite/" class="post-tag"><span class="tag is-primary">Sqllite</span></a></div></div><div class="content post_detail__content"><p>Eine der vielen Möglichkeiten für das Speichern von Daten innerhalb einer <a href="https://flutter.dev/">Flutter-App</a> ist <a href="https://www.sqlite.org/index.html">SQlite</a>. SQlite bietet eine Relationale-Datenbank innerhalb der App ohne externe Ahhänigkeit und ohne Datenverkehr über das Internet. Es ist sehr praktisch und für kleinere, einfachere Statements performant. Wer eine Übersicht über die Möglichkeiten zum Speichern von Daten innerhalb von Flutter sucht, dem empfehle ich folgenden <a href="https://objectbox.io/flutter-databases-sqflite-hive-objectbox-and-moor/">Artikel (flutter-databases-sqflite-hive-objectbox-and-moor)</a>. <a href="https://flutter.dev/docs/cookbook/persistence/sqlite">Die Flutter-Doku</a> erklärt sehr gut wie man SQlite in seiner App integriert.</p><p>Ich habe eine App gebaut, die Daten in der SQlite abspeichert. Nun stand ich vor dem Problem wie ich die Daten migrieren kann, falls ich z.B. das Handy wechsle. Da SQlite die Daten in eine *.db Datei schreibt, muss es eine Möglichkeit geben an diese Datei auf dem Telefon zu gelangen und diese aus der App zu exportieren. Wie man das erreichen kann, möchte ich mit euch teilen.</p><p>Voraussetzung ist eine Flutter App und folgende Bibliotheken:</p><pre class="language-yaml"><code class="language-yaml"><span class="highlight-line"><span class="token key atrule">dependencies</span><span class="token punctuation">:</span></span><br><span class="highlight-line">    <span class="token key atrule">flutter</span><span class="token punctuation">:</span></span><br><span class="highlight-line">        <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter</span><br><span class="highlight-line">    <span class="token key atrule">sqflite</span><span class="token punctuation">:</span></span><br><span class="highlight-line">    <span class="token key atrule">path</span><span class="token punctuation">:</span></span><br><span class="highlight-line">    <span class="token key atrule">permission_handler</span><span class="token punctuation">:</span> ^7.0.0</span><br><span class="highlight-line">    <span class="token key atrule">downloads_path_provider</span><span class="token punctuation">:</span> ^0.1.0</span></code></pre><ul><li><strong>sqflite</strong>: SQlite-Bibliothek</li><li><strong>path</strong>: Pfade</li><li><strong>permission_handler</strong>: Rechte auf dem Gerät</li><li><strong>downloads_path_provider</strong>: Pfad zum Downloads-Ordner</li></ul><p>Die Idee der Umsetzung war folgende:</p><ol><li>Überprüfe die Schreibrechte auf dem Gerät.</li><li>Finde den Pfad zur *.db-Datei.</li><li>Öffne diese Datei und schreibe eine Kopie in das Download-Verzeichnis des Telefons.</li></ol><br><h4 id="1.-schreibrechte" tabindex="-1">1. Schreibrechte <a class="direct-link" href="#1.-schreibrechte">#</a></h4><p>Damit man Dateien auf dem Telefon schreiben und lesen kann, benötigt man Schreibrechte. <strong>Achtung!</strong> Ich beziehe mich hier nur auf das Android-System.<br>Um an Schreibrechte zu gelangen muss man folgende Zeilen in die Datei <strong><em>/android/app/src/main/AndroidManifest.xml</em></strong> hinzufügen.</p><pre class="language-xml"><code class="language-xml"><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.READ_EXTERNAL_STORAGE<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></span></code></pre><p>Damit der Nutzer überhaupt mitbekommt, dass diese Rechte benötigt werden, empfehle ich das Paket <em>permission_handler</em>. Damit kann man den Nutzer komfortabel auf Schreibrechte hinweisen und diese direkt auch abfragen.</p><pre class="language-dart"><code class="language-dart"><span class="highlight-line"><span class="token keyword">var</span> status <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">Permission</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span>status<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span>isDenied<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">await</span> <span class="token class-name">Permission</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Die erste Zeile fragt das System an, ob überhaupt Rechte in der oben beschriebenen xml eingetragen wurden und dann das Telefon, ob der Telefonnutzer die Rechte freigegeben hat. Die dritte Zeile lässt einen Dialog erscheinen, der dem Nutzer diese Auwahl anbietet.</p><p><img src="/content/img/0521/right-granted.png" alt="schreibrechte" title="schreibrechte"></p><p>Wurden diese Rechte erlaubt, können wir die Dateien schreiben.</p><h4 id="2.-dateipfade" tabindex="-1">2. Dateipfade <a class="direct-link" href="#2.-dateipfade">#</a></h4><p>Die Dateipfade sind etwas versteckt und wir benötigen die oben genannten Module als Hilfe.</p><p><strong>Pfad zur bestehenden Datenbank.db</strong></p><pre class="language-dart"><code class="language-dart"><span class="highlight-line"><span class="token class-name">String</span> dbName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"doggie_database.db"</span></span><span class="token punctuation">;</span> <span class="token comment">// name of the db</span></span><br><span class="highlight-line"><span class="token keyword">var</span> databasesPath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDatabasesPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// default database path</span></span><br><span class="highlight-line"><span class="token keyword">var</span> innerPath <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>databasesPath<span class="token punctuation">,</span> dbName<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token function">print</span><span class="token punctuation">(</span>innerPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// /data/user/0/com.example.flutter_sqlite_database_export/databases/doggie_database.db</span></span></code></pre><p><strong>Pfad ins Downloadverzeichnis</strong></p><pre class="language-dart"><code class="language-dart"><span class="highlight-line"><span class="token class-name">Directory</span> tempDir <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">DownloadsPathProvider</span><span class="token punctuation">.</span>downloadsDirectory<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token class-name">String</span> tempPath <span class="token operator">=</span> tempDir<span class="token punctuation">.</span>path<span class="token punctuation">;</span></span></code></pre><p><strong>Ausflug in dein Android-Datenbankverzeichnis</strong><br>Wer in seine bestehende und laufende Applikation reinschauen möchte, dem empfehle ich im Android-Studio den <strong><em>Device-File-Explorer</em></strong>.</p><p><img src="/content/img/0521/file-explorer.png" alt="device file explorer" title="device file explorer"></p><p>Unter <strong><em>/data/data/[name eurer applikation]/databases/nameEurerDB.db</em></strong> findet ihr eure SQlite Datenbank und könnte diese exportieren.</p><h4 id="3.-datenbank.db-exportieren" tabindex="-1">3. Datenbank.db exportieren <a class="direct-link" href="#3.-datenbank.db-exportieren">#</a></h4><pre class="language-dart"><code class="language-dart"><span class="highlight-line"><span class="token keyword">var</span> dbFile <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">(</span>innerPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">var</span> filePath <span class="token operator">=</span> tempPath <span class="token operator">+</span> <span class="token string-literal"><span class="token string">'/</span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">dbName</span></span><span class="token string">'</span></span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">var</span> dbFileBytes <span class="token operator">=</span> dbFile<span class="token punctuation">.</span><span class="token function">readAsBytesSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">var</span> bytes <span class="token operator">=</span> <span class="token class-name">ByteData</span><span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>dbFileBytes<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">final</span> buffer <span class="token operator">=</span> bytes<span class="token punctuation">.</span>buffer<span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAsBytes</span><span class="token punctuation">(</span></span><br><span class="highlight-line">  buffer<span class="token punctuation">.</span><span class="token function">asUint8List</span><span class="token punctuation">(</span></span><br><span class="highlight-line">    dbFileBytes<span class="token punctuation">.</span>offsetInBytes<span class="token punctuation">,</span> dbFileBytes<span class="token punctuation">.</span>lengthInBytes</span><br><span class="highlight-line"><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Die Datenbank-Datei wird als Bytes gelesen, und im Standard Dart I/O Verfahren von einem Ort zum anderen geschrieben. So erhält man eine Datenbank-Export für die in der App verwendete Datenbank.</p><p>Hier nochmal die ganze Methode samt Aufruf:</p><pre class="language-dart"><code class="language-dart"><span class="highlight-line"><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">></span></span> <span class="token function">_writeDBFileToDownloadFolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token class-name">String</span> dbName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"doggie_database.db"</span></span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">var</span> databasesPath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDatabasesPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">var</span> innerPath <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>databasesPath<span class="token punctuation">,</span> dbName<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token function">print</span><span class="token punctuation">(</span>innerPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token class-name">Directory</span> tempDir <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">DownloadsPathProvider</span><span class="token punctuation">.</span>downloadsDirectory<span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token class-name">String</span> tempPath <span class="token operator">=</span> tempDir<span class="token punctuation">.</span>path<span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token keyword">var</span> dbFile <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">(</span>innerPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">var</span> filePath <span class="token operator">=</span> tempPath <span class="token operator">+</span> <span class="token string-literal"><span class="token string">'/</span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">dbName</span></span><span class="token string">'</span></span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">var</span> dbFileBytes <span class="token operator">=</span> dbFile<span class="token punctuation">.</span><span class="token function">readAsBytesSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">var</span> bytes <span class="token operator">=</span> <span class="token class-name">ByteData</span><span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>dbFileBytes<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">final</span> buffer <span class="token operator">=</span> bytes<span class="token punctuation">.</span>buffer<span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAsBytes</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">asUint8List</span><span class="token punctuation">(</span></span><br><span class="highlight-line">        dbFileBytes<span class="token punctuation">.</span>offsetInBytes<span class="token punctuation">,</span> dbFileBytes<span class="token punctuation">.</span>lengthInBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><br><span class="highlight-line">onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">var</span> status <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">Permission</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span>status<span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span>isDenied<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">await</span> <span class="token class-name">Permission</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_writeDBFileToDownloadFolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// not null safe</span></span><br><span class="highlight-line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"success"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><br><span class="highlight-line"></span></code></pre><p>Schaut man nun auf dem Telefon über die App &quot;Files&quot; in das Downloadverzeichnis, findet man die besagte Datei.</p><p>Great Success! :-)</p><p>Diese Code-Blöcke eingebacken in die Flutter-Starter-Applikation habe ich unter <a href="https://github.com/derKuba/flutter-sqlite-database-export">Github</a> für euch zur Verfügung gestellt.</p><p>Ihr habt Fragen oder Anregungen? Schreibt mir bei <a href="https://twitter.com/der_kuba">Twitter</a></p><p><strong><em>Nachtrag vom 07.05.2021</em></strong><br>Auf Android Q reicht der oben erwähnte Zusatz in der XML nicht aus. Man muss noch folgendes ergänzen:</p><pre><code>  android:requestLegacyExternalStorage=&quot;true&quot;
</code></pre><p>sodass die <strong><em>/android/app/src/main/AndroidManifest.xml</em></strong> wie folgt aussieht:</p><pre><code>&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
  package=&quot;com.example.flutter_sqlite_database_export&quot;&gt;
  &lt;application
    android:label=&quot;flutter_sqlite_database_export&quot;
    android:requestLegacyExternalStorage=&quot;true&quot;
    android:icon=&quot;@mipmap/ic_launcher&quot;&gt;
    ....
    &lt;/application&gt;
    &lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot;/&gt;
    &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;
&lt;/manifest&gt;
</code></pre><p>Ihr habt Fragen oder Anregungen? Schreibt mir bei <a href="https://twitter.com/der_kuba">Twitter</a>.</p><p><br>Tausend Dank fürs Lesen!</p><p>Kuba</p><hr><ul class="post-navigation"><li>Nächster Artikel: <a href="/content/posts/0521/bewerbungsgespraech-leiten/">Vorstellungsgespräche leiten, ein gutes Gespräch für beide Seiten.</a></li><li>Vorheriger Artikel: <a href="/content/posts/0421/typescript-spread-operator-aha/">Spass mit Typescript: Spread-Operator AHA-Moment</a></li></ul></div></div></div></div></section><footer class="footer"><hr><div class="content has-text-centered"><p>der_kuba - 2023 - <a href="/content/impressum.html">Impressum</a> - <a href="/content/datenschutz.html">Datenschutzerklärung</a></p></div></footer></body></html>