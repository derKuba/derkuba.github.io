<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>How to import SQlite Database File in Flutter (Android)</title><meta name="description" content="SQlite Database aus der Applikation importieren unter Android"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link href="/template/css/prism.css" rel="stylesheet"><link rel="stylesheet" href="/template/css/bulma.min.css"><link rel="stylesheet" href="/template/css/custom.css"><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="der_kuba"><link rel="alternate" href="/feed/feed.json" type="application/json" title="der_kuba"><script>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,a=document.getElementById(t);e.classList.toggle("is-active"),a.classList.toggle("is-active")})})});</script></head><body><header><div class="container"><nav class="navbar is-transparent"><div class="navbar-brand"><a class="navbar-item navbar-brand__title" href="/">der_kuba </a><a class="navbar-item" href="https://github.com/derKuba">@Github </a><a class="navbar-item" href="https://twitter.com/der_kuba">@Twitter</a><div class="navbar-burger" data-target="navigation-items"><span></span> <span></span> <span></span></div></div><div id="navigation-items" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home </a><a class="navbar-item" href="/posts/">Archive </a><a class="navbar-item" href="/content/about/">About Me </a><a class="navbar-item" href="/content/impressum.html">Impressum </a><a class="navbar-item" href="/content/datenschutz.html">Datenschutzerklärung</a></div></div></nav></div></header><section class="section"><div class="container"><div class="columns is-centered"><div class="column is-8"><h1 class="title is-3">How to import SQlite Database File in Flutter (Android)</h1><div class="post-detail__tags"><h3 class="subtitle is-6"><time datetime="2021-05-13">13 May 2021</time></h3><div class="tags"><a href="/tags/flutter/" class="post-tag"><span class="tag is-black">Flutter </span></a><a href="/tags/sqllite/" class="post-tag"><span class="tag is-primary">Sqllite</span></a></div></div><div class="content post_detail__content"><p>Vor kurzem habe ich erklärt wie man aus seiner App die <a href="https://www.sqlite.org/index.html">SQlite-Datenbank</a> exportiert. In diesem Artikel erkläre ich wie man diese importiert. Voraussetzung ist ein bestehendes Flutter-Projekt und ein SQlite-Datenbank im Download-Verzeichnis des Telefons.</p><p>Benötigte Bibliotheken sind folgende:</p><pre class="language-yaml"><code class="language-yaml"><span class="highlight-line"><span class="token key atrule">dependencies</span><span class="token punctuation">:</span></span><br><span class="highlight-line">  <span class="token key atrule">flutter</span><span class="token punctuation">:</span></span><br><span class="highlight-line">    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter</span><br><span class="highlight-line">  <span class="token key atrule">sqflite</span><span class="token punctuation">:</span></span><br><span class="highlight-line">  <span class="token key atrule">path</span><span class="token punctuation">:</span></span><br><span class="highlight-line">  <span class="token key atrule">permission_handler</span><span class="token punctuation">:</span> ^7.0.0</span><br><span class="highlight-line">  <span class="token key atrule">downloads_path_provider</span><span class="token punctuation">:</span> ^0.1.0</span></code></pre><p>Die Vorgehensweise strukturiert sich folgendermaßen:</p><ol><li>Lege eine neue Seite für den Import an und gebe den Dateipfad hinein</li><li>Lese Dateien aus dem Download-Verzeichnis und filtere nach <em>&quot;.db&quot;</em></li><li>Zeige die Dateien an.</li><li>Kopiere diese in das Datenbankverzeichnis</li></ol><p>Ich gehe davon aus, dass mehrere Dateien für den Import zur Verfügung stehen und man den Nutzer vor die Wahl stellen kann, welche er importieren möchte. Für die Auswahl aus einer Liste bieten sich Radiobuttons an. In Flutter gibt es dazu die <em><strong>RadioListTile</strong></em>:</p><pre class="language-dart"><code class="language-dart"><span class="highlight-line">String selectedFile <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><br><span class="highlight-line">RadioListTile<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span></span><br><span class="highlight-line">    title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span>path <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// Der Titel ist der Pfad der Datei</span></span><br><span class="highlight-line">    value<span class="token punctuation">:</span> fileName<span class="token punctuation">.</span>path<span class="token punctuation">,</span>             <span class="token comment">//  und der Wert ebenfalls.</span></span><br><span class="highlight-line">    groupValue<span class="token punctuation">:</span> selectedFile<span class="token punctuation">,</span>        <span class="token comment">//   Zum Anzeigen der Auswahl benötigt man eine Merkvariable, die den ausgewählten Wert repräsentiert.</span></span><br><span class="highlight-line">    onChanged<span class="token punctuation">:</span> <span class="token punctuation">(</span>String value<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">//    In der Change-Funktion wird diese Merkervariabel ge- und überschrieben. </span></span><br><span class="highlight-line">      <span class="token function">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        selectedFile <span class="token operator">=</span> value<span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Das Ganze sieht dann aus wie folgt:</p><p><img src="/content/img/0521/import_ui.png" alt="Dateiauswahl" title="Dateiauswahl"></p><div class="has-text-right image-subline">Bild 1: RadioListTile in Aktion</div><p></p><p>Der grüne Knopf im unteren Bereich heißt <em><strong>FloatingActionButton</strong></em> und hat auf seiner onPressed-Methode folgende Funktion:</p><pre class="language-dart"><code class="language-dart"><span class="highlight-line">  <span class="token function">_importDB</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function">print</span><span class="token punctuation">(</span>selectedFile<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedFile <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token keyword">var</span> status <span class="token operator">=</span> <span class="token keyword">await</span> Permission<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>status<span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>status<span class="token punctuation">.</span>isGranted<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">await</span> Permission<span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">var</span> srcFile <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>selectedFile<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token keyword">var</span> dbFileBytes <span class="token operator">=</span> srcFile<span class="token punctuation">.</span><span class="token function">readAsBytesSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token keyword">var</span> bytes <span class="token operator">=</span> ByteData<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>dbFileBytes<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token keyword">final</span> buffer <span class="token operator">=</span> bytes<span class="token punctuation">.</span>buffer<span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">        <span class="token keyword">var</span> databasesPath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDatabasesPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token keyword">var</span> distPath <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>databasesPath<span class="token punctuation">,</span> <span class="token string">'doggy__${DateTime.now()}.db'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">        <span class="token keyword">await</span> <span class="token function">File</span><span class="token punctuation">(</span>distPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAsBytes</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">asUint8List</span><span class="token punctuation">(</span></span><br><span class="highlight-line">            dbFileBytes<span class="token punctuation">.</span>offsetInBytes<span class="token punctuation">,</span> dbFileBytes<span class="token punctuation">.</span>lengthInBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token function">print</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span></code></pre><p>Im ersten Teil prüfen wir, ob eine Datei ausgewählt wurde und im Anschluss ob wir überhaupt Lese- und Schreibezugriff auf dem Smartphone haben. Wir holen, bzw. lesen dann die Datei aus dem Downloadverzeichnis aus (Zeile 9-12). Dann lesen wir den Pfad des Downloadverzeichnis aus und bauen aus dem Pfad und dem Dateinamen einen neuen Pfad (Zeile 14-15). In Zeile 17+18 schreiben wir die Datei in das Datenbankverzeichnis des Telefons.</p><p>Natürlich kann man hier jetzt viele verschiedene Variationen einbauen. So kann man z.B. die alte Datenbankdatei erstmal umbenennen und als Backup vorhalten. Alternativ kann man die alte Datei auch löschen. Wichtig ist, dass man in der laufenden Anwendung die aktuelle Datenbank schließt und neu ausliest, denn sonst hat die alten Daten im Speicher und muss die App erstmal neustarten.</p><p>PS: Ab Android 11 (targetSdkVersion 30) wurde einiges am Rechtemanagement umgestellt. Das hat z.B. den Effekt, dass man die DB-Dateien aus APP A in APP B im Download-Verzeichnis nicht sehen kann. Um dies zu umgehen bin ich in meinen Apps auf targetSdkVersion 29 geblieben bis alle benötigten Flutter-Plugins targetSdkVersion 30 auch ausreichend unterstützen.</p><hr><ul><li>Nächster Artikel: <a href="/content/posts/0521/fun-with-no-break-character/">Fuckup der Woche: no break character</a></li><li>Vorheriger Artikel: <a href="/content/posts/0521/bewerbungsgespraech-leiten/">Vorstellungsgespräche leiten, ein gutes Gespräch für beide Seiten.</a></li></ul></div></div></div></div></section><footer class="footer"><hr><div class="content has-text-centered"><p>der_kuba - 2021 - <a href="/content/impressum.html">Impressum</a> - <a href="/content/datenschutz.html">Datenschutzerklärung</a></p></div></footer></body></html>