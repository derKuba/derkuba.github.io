<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fuckup der Woche: &#39;no-break space&#39; - das geschützte Leerzeichen</title><meta name="description" content="Man sieht es nicht und dennoch ist es da"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link href="/template/css/prism.css" rel="stylesheet"><link rel="stylesheet" href="/template/css/bulma.min.css"><link rel="stylesheet" href="/template/css/custom.css"><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="der_kuba"><link rel="alternate" href="/feed/feed.json" type="application/json" title="der_kuba"><script>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,a=document.getElementById(t);e.classList.toggle("is-active"),a.classList.toggle("is-active")})})});</script></head><body><header><div class="container"><nav class="navbar is-transparent"><div class="navbar-brand"><a class="navbar-item navbar-brand__title" href="/">der_kuba </a><a class="navbar-item" href="https://github.com/derKuba">@Github </a><a class="navbar-item" href="https://twitter.com/der_kuba">@Twitter</a><div class="navbar-burger" data-target="navigation-items"><span></span> <span></span> <span></span></div></div><div id="navigation-items" class="navbar-menu"><div class="navbar-end"><a class="navbar-item" href="/">Home </a><a class="navbar-item" href="/posts/">Archive </a><a class="navbar-item" href="/content/about/">About Me </a><a class="navbar-item" href="/content/impressum.html">Impressum </a><a class="navbar-item" href="/content/datenschutz.html">Datenschutzerklärung</a></div></div></nav></div></header><section class="section"><div class="container"><div class="columns is-centered"><div class="column is-8"><h1 class="title is-3">Fuckup der Woche: &#39;no-break space&#39; - das geschützte Leerzeichen</h1><div class="post-detail__tags"><h3 class="subtitle is-6"><time datetime="2021-05-21">21 May 2021</time></h3><div class="tags"><a href="/tags/typescript/" class="post-tag"><span class="tag is-black">Typescript</span></a></div></div><div class="content post_detail__content"><h4 id="warum-%2223.42-%E2%82%AC%22-nicht-gleich-%2223.42-%E2%82%AC%22-sind-%3F" tabindex="-1">Warum &quot;23.42 €&quot; nicht gleich &quot;23.42 €&quot; sind ? <a class="direct-link" href="#warum-%2223.42-%E2%82%AC%22-nicht-gleich-%2223.42-%E2%82%AC%22-sind-%3F">#</a></h4><p>Die Antwort auf diese Frage hat mich diese Woche viel Zeit gekostet. Um sicherzustellen, dass meine Webanwendung auch das macht was sie verspricht setze ich auf E2E Tests. Dieser Blackbox-Test benutzt einen Browser, gibt die URL meiner Webanwendung ein und klickt diese dann anhand der definierten Testfälle durch. Anschließend liest er Werte aus und vergleicht diese mit vorher definierten Werten. Im konkreten Fall sollte er eine Rechnung überprüfen. Die Überprüfung ist ein einfacher Textvergleich, wie z.B.:</p><pre><code>&quot;23,42 €&quot; == &quot;18.24 $&quot;
</code></pre><p>Man sieht sofort, dass da was nicht stimmt und kann nach der Ursache forschen.</p><p>In meinem Fall lautete der Fehler auf der Konsole aber:</p><pre><code>Error: '231,63 €' is not included in '231,63 €'...
</code></pre><p>Nach einem Vergleich Zeichen für Zeichen kam dann die Verwunderung. Scheinbar ist das Leerzeichen schuld. Das Leerzeichen wird aber nicht manuell eingefügt, sondern kommt aus der TS/JS-internen Bibliothek. Für die Darstellung des Preises soll aus der typescript number &quot;232.23&quot; die deutsche Schreibweise für einen Preis inklusive Währung erscheinen. Dafür wird die Methode <strong>&quot;toLocaleString&quot;</strong> benutzt. Diese generiert mir die Anzeige automatisch.</p><pre class="language-typescript"><code class="language-typescript"><span class="highlight-line"><span class="token comment">// Wir nehmen eine einfach Summe:</span></span><br><span class="highlight-line"><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token number">232.23</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// Wandeln diese in die deutsche Schreibweise inklusive Währung.</span></span><br><span class="highlight-line"><span class="token keyword">let</span> sumDisplay <span class="token operator">=</span> sum<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token string">"de-DE"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    style<span class="token operator">:</span> <span class="token string">"currency"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    currency<span class="token operator">:</span> <span class="token string">"EUR"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    minimumFractionDigits<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    maximumFractionDigits<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// output: 232,23 €</span></span></code></pre><p>Vergleicht man nun das Ouput aus der Konsole mit dem erwarteten Ergebnis:</p><pre class="language-typescript"><code class="language-typescript"><span class="highlight-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Ist "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sumDisplay<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" === "232,23 €" ??? </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sumDisplay <span class="token operator">===</span> <span class="token string">"232,23 €"</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> \n</span><span class="token template-punctuation string">`</span></span></span><br><span class="highlight-line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// output: Ist "232,23 €" === "232,23 €" ??? false</span></span></code></pre><p>Den Grund dafür kann man sich auf der Konsole ausgeben lassen, wenn man sich Zeichen für Zeichen aus der UTF-16 Tabelle ausgibt:</p><pre class="language-typescript"><code class="language-typescript"><span class="highlight-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Zeige dich Zeichen in UTF-16 an: \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">sumDisplay<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span></span><br><span class="highlight-line">  <span class="token punctuation">(</span>character<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>character<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> => </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>character<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// print Ascii Code</span></span><br><span class="highlight-line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// output:</span></span><br><span class="highlight-line"><span class="token number">2</span> <span class="token operator">=></span> <span class="token number">50</span></span><br><span class="highlight-line"><span class="token number">3</span> <span class="token operator">=></span> <span class="token number">51</span></span><br><span class="highlight-line"><span class="token number">2</span> <span class="token operator">=></span> <span class="token number">50</span></span><br><span class="highlight-line"><span class="token punctuation">,</span> <span class="token operator">=></span> <span class="token number">44</span></span><br><span class="highlight-line"><span class="token number">2</span> <span class="token operator">=></span> <span class="token number">50</span></span><br><span class="highlight-line"><span class="token number">3</span> <span class="token operator">=></span> <span class="token number">51</span></span><br><span class="highlight-line">  <span class="token operator">=></span> <span class="token number">160</span></span><br><span class="highlight-line">€ <span class="token operator">=></span> <span class="token number">8364</span></span></code></pre><p>Welche Nummer hat denn das &quot; &quot;-Whitespace? (32):</p><pre class="language-typescript"><code class="language-typescript"><span class="highlight-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"\n whitespace ' ' ist nicht gleich ' ' "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">" "</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ist nicht gleich </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">" "</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Whitespace ist nicht gleich NO-BREAK SPACE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Es handelt sich nicht um das &quot;normale&quot; Whitespace, sondern um das &quot;No-Break-Space&quot;. Der grundlegende Unterschied ist, dass diese nicht umgebrochen werden darf, damit der Preis nicht vom Währungszeichen getrennt wird. Der Stringvergleich scheitert dabei natürlich.<br>Bei der Recherche bin ich auf <a href="https://de.wikipedia.org/wiki/Gesch%C3%BCtztes_Leerzeichen">eine ganze Liste von Whitespaces</a> gestoßen.<br>Mein Learning der Woche war damit abgeschlossen. Vertraue keinen Zeichen, die du nicht siehst.</p><p>Wer sich mehr Zeichen anschauen möchte, kann diese natürlich sich ausgeben. Hier ein kleines Beispiel für unser Alphabet:</p><pre class="language-typescript"><code class="language-typescript"><span class="highlight-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"\n\n\n\n UTF-16 code TABLE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">const</span> alphabet <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">49</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> <span class="token number">127</span><span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    alphabet<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>index<span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span>alphabet<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">┌─────────┬─────┬──────┐</span><br><span class="highlight-line"><span class="token function">│</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> │  <span class="token number">0</span>  │  <span class="token number">1</span>   │</span><br><span class="highlight-line">├─────────┼─────┼──────┤</span><br><span class="highlight-line">│    <span class="token number">0</span>    │ <span class="token number">49</span>  │ <span class="token string">'1'</span>  │</span><br><span class="highlight-line">│    <span class="token number">1</span>    │ <span class="token number">50</span>  │ <span class="token string">'2'</span>  │</span><br><span class="highlight-line">│    <span class="token number">2</span>    │ <span class="token number">51</span>  │ <span class="token string">'3'</span>  │</span><br><span class="highlight-line">│    <span class="token number">3</span>    │ <span class="token number">52</span>  │ <span class="token string">'4'</span>  │</span><br><span class="highlight-line">│    <span class="token number">4</span>    │ <span class="token number">53</span>  │ <span class="token string">'5'</span>  │</span><br><span class="highlight-line">│    <span class="token number">5</span>    │ <span class="token number">54</span>  │ <span class="token string">'6'</span>  │</span><br><span class="highlight-line">│    <span class="token number">6</span>    │ <span class="token number">55</span>  │ <span class="token string">'7'</span>  │</span><br><span class="highlight-line">│    <span class="token number">7</span>    │ <span class="token number">56</span>  │ <span class="token string">'8'</span>  │</span><br><span class="highlight-line">│    <span class="token number">8</span>    │ <span class="token number">57</span>  │ <span class="token string">'9'</span>  │</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token operator">...</span><span class="token operator">...</span></span></code></pre><p>Diese Code-Blöcke habe ich unter <a href="https://github.com/derKuba/fun-with-typescript/tree/main/fun-with-localstring">Github</a> für euch zur Verfügung gestellt.</p><p>Ihr habt Fragen oder Anregungen? Schreibt mir bei <a href="https://twitter.com/der_kuba">Twitter</a>.<br><br><br>Tausend Dank fürs Lesen!</p><p>Kuba</p><hr><ul class="post-navigation"><li>Nächster Artikel: <a href="/content/posts/stenciljs/introduction/">StencilJS-Tutorial: Einführung</a></li><li>Vorheriger Artikel: <a href="/content/posts/0521/flutter-import-sqlite-db/">How to import SQlite Database File in Flutter (Android)</a></li></ul></div></div></div></div></section><footer class="footer"><hr><div class="content has-text-centered"><p>der_kuba - 2023 - <a href="/content/impressum.html">Impressum</a> - <a href="/content/datenschutz.html">Datenschutzerklärung</a></p></div></footer></body></html>